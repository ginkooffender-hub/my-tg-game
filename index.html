<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MONEY TREE üéÆ ULTIMATE</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0f1e, #1a1f3a);
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
            position: relative;
        }
        
        /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Ñ–æ–Ω */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(0deg, 
                    rgba(0,0,0,0.15) 0px, 
                    rgba(0,0,0,0.15) 2px,
                    transparent 2px,
                    transparent 4px);
            pointer-events: none;
            z-index: 1000;
            animation: scanlines 8s linear infinite;
        }
        
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }
        
        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .cartridge {
            width: 100%;
            max-width: 440px;
            background: #1e2a3a;
            border: 6px solid #ff6b6b;
            border-radius: 30px 30px 15px 15px;
            padding: 20px 12px;
            position: relative;
            box-shadow: 
                0 15px 0 #b22222,
                0 20px 20px rgba(0,0,0,0.5);
            max-height: 700px;
            overflow-y: auto;
            scrollbar-width: none;
        }
        
        .cartridge::-webkit-scrollbar {
            display: none;
        }
        
        .cartridge-label {
            position: sticky;
            top: 0;
            background: #ffd700;
            color: #000;
            font-size: 12px;
            padding: 8px 20px;
            border-radius: 20px;
            border: 3px solid #b8860b;
            text-align: center;
            margin-bottom: 10px;
            z-index: 100;
            box-shadow: 0 4px 0 #8b6910;
        }
        
        .screen {
            background: #0a1420;
            border: 6px solid #4a4a6a;
            border-radius: 20px;
            padding: 15px;
            margin: 15px 0 20px 0;
            box-shadow: inset 0 0 30px rgba(0,255,0,0.2);
        }
        
        .led-panel {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 5px;
            background: #000;
            border: 2px solid #3a3a5a;
        }
        
        .led {
            color: #ff4d4d;
            font-size: 10px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .score-panel {
            background: #000;
            border: 4px solid #ffd700;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .coin-sprite {
            font-size: 28px;
            filter: drop-shadow(0 0 10px #ffd700);
            animation: spin 2s steps(8) infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .score-value {
            color: #ffd700;
            font-size: 24px;
            text-shadow: 4px 4px 0 #8b6910;
            letter-spacing: 2px;
        }
        
        .tree-area {
            background: #2a5a3a;
            border: 6px solid #1e3a2a;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            cursor: pointer;
            position: relative;
            box-shadow: 
                0 10px 0 #1e3a2a,
                inset 0 -5px 0 #3a7a4a;
            transition: all 0.03s linear;
        }
        
        .tree-area:active {
            transform: translateY(10px);
            box-shadow: 0 0 0 #1e3a2a;
        }
        
        .tree-sprite {
            font-size: 120px;
            display: block;
            filter: drop-shadow(0 10px 0 #1e3a2a);
            animation: treeSway 2s infinite;
        }
        
        @keyframes treeSway {
            0%, 100% { transform: rotate(0deg); }
            33% { transform: rotate(2deg); }
            66% { transform: rotate(-2deg); }
        }
        
        .energy-container {
            margin: 20px 0;
            background: #1a1a3a;
            border: 4px solid #4a4a8a;
            padding: 15px;
        }
        
        .energy-header {
            display: flex;
            justify-content: space-between;
            color: #7fffd4;
            font-size: 12px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #2a6a6a;
        }
        
        .energy-track {
            background: #2a2a5a;
            height: 25px;
            border: 3px solid #6a6aaa;
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #7fffd4, #40e0d0);
            width: 100%;
            box-shadow: inset 0 2px 0 #b0ffff;
            transition: width 0.1s steps(5);
        }
        
        .power-indicator {
            color: #ffb347;
            font-size: 10px;
            text-align: center;
            margin: 10px 0;
            text-shadow: 2px 2px 0 #b85e00;
        }
        
        .crit-indicator {
            color: #ff6b6b;
            font-size: 8px;
            text-align: center;
            margin: 5px 0;
            animation: critPulse 1s infinite;
        }
        
        @keyframes critPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; text-shadow: 0 0 10px red; }
        }
        
        .menu-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin: 20px 0;
        }
        
        .menu-btn {
            background: #ff6b6b;
            border: none;
            border-bottom: 6px solid #b22222;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            padding: 15px 0;
            cursor: pointer;
            text-align: center;
            text-shadow: 2px 2px 0 #8b0000;
            transition: all 0.03s linear;
        }
        
        .menu-btn:active {
            transform: translateY(6px);
            border-bottom-width: 2px;
        }
        
        .menu-btn.active {
            background: #ffd700;
            color: #000;
            text-shadow: 2px 2px 0 #b8860b;
            border-bottom-color: #b8860b;
        }
        
        /* –ú–ê–ì–ê–ó–ò–ù –ò –ë–£–°–¢–´ */
        .shop-container {
            background: #1e2a3a;
            border: 4px solid #ffd700;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .shop-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .shop-container::-webkit-scrollbar-track {
            background: #1e2a3a;
        }
        
        .shop-container::-webkit-scrollbar-thumb {
            background: #ffd700;
            border: 2px solid #b8860b;
        }
        
        .shop-item {
            background: #2a3a5a;
            border: 4px solid #4a6a9a;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.1s;
        }
        
        .shop-item.special {
            border-color: #ff6b6b;
            background: #3a2a5a;
        }
        
        .shop-item.vip {
            border-color: #ffd700;
            background: #2a1a3a;
            box-shadow: 0 0 20px gold;
        }
        
        .item-info h3 {
            color: #ffd700;
            font-size: 10px;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0 #8b6910;
        }
        
        .item-desc {
            color: #aaccff;
            font-size: 7px;
            margin-bottom: 5px;
        }
        
        .item-price {
            color: #7fffd4;
            font-size: 9px;
        }
        
        .item-level {
            color: #ffb347;
            font-size: 8px;
            margin-top: 3px;
        }
        
        .buy-btn {
            background: #ffd700;
            border: none;
            border-bottom: 4px solid #b8860b;
            color: #000;
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            padding: 10px 12px;
            cursor: pointer;
            min-width: 70px;
        }
        
        .buy-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        
        .friends-area {
            background: #2a3a5a;
            border: 4px solid #4a6a9a;
            padding: 20px;
            margin-top: 15px;
            text-align: center;
        }
        
        .invite-btn {
            background: #7fffd4;
            border: none;
            border-bottom: 6px solid #40e0d0;
            color: #000;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            padding: 20px;
            width: 100%;
            cursor: pointer;
            margin: 15px 0;
            text-shadow: 2px 2px 0 #20b2aa;
        }
        
        .friend-counter {
            color: #ffd700;
            font-size: 10px;
            text-shadow: 2px 2px 0 #8b6910;
        }
        
        .popup-8bit {
            position: fixed;
            color: #ffd700;
            font-family: 'Press Start 2P', cursive;
            font-size: 20px;
            pointer-events: none;
            z-index: 9999;
            text-shadow: 
                4px 4px 0 #b8860b,
                -2px -2px 0 #ff8c00;
            animation: popupFloat 0.6s steps(5) forwards;
        }
        
        .popup-crit {
            color: #ff6b6b;
            text-shadow: 
                4px 4px 0 #8b0000,
                -2px -2px 0 #ff4500;
            font-size: 28px;
        }
        
        @keyframes popupFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-120px) scale(2); opacity: 0; }
        }
        
        .hit-flash {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 215, 0, 0.5);
            animation: flash 0.1s steps(2);
            pointer-events: none;
        }
        
        .hit-flash.crit {
            background: rgba(255, 0, 0, 0.7);
        }
        
        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.3s steps(5);
        }
        
        .boot-box {
            background: #1a2a3a;
            border: 8px solid #ff6b6b;
            padding: 40px 30px;
            text-align: center;
            max-width: 350px;
            box-shadow: 0 20px 0 #8b0000;
        }
        
        .boot-title {
            color: #ffd700;
            font-size: 20px;
            margin-bottom: 25px;
            text-shadow: 5px 5px 0 #8b6910;
        }
        
        .boot-animation {
            font-size: 70px;
            margin: 20px 0;
            animation: bootBob 0.5s steps(2) infinite;
        }
        
        @keyframes bootBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .boot-text {
            color: #7fffd4;
            font-size: 12px;
            margin: 25px 0;
            line-height: 2;
        }
        
        .power-btn {
            background: #ff6b6b;
            border: none;
            border-bottom: 8px solid #b22222;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 18px;
            padding: 20px 30px;
            width: 100%;
            cursor: pointer;
            margin-top: 20px;
            text-shadow: 3px 3px 0 #8b0000;
        }
        
        .power-btn:active {
            transform: translateY(8px);
            border-bottom-width: 4px;
        }
        
        .hidden {
            display: none;
        }
        
        .stats-line {
            display: flex;
            justify-content: space-between;
            color: #aaccff;
            font-size: 8px;
            margin: 10px 0;
            padding: 5px;
            background: #1a1a3a;
            border: 2px solid #3a3a6a;
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div id="bootScreen" class="boot-screen">
        <div class="boot-box">
            <div class="boot-title">üí∞ MONEY TREE üí∞</div>
            <div class="boot-animation" id="bootEmoji">üå±</div>
            <div class="boot-text" id="bootMessage">ULTIMATE EDITION</div>
            <button class="power-btn" id="startBtn">POWER</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–∞ -->
    <div class="cartridge">
        <div class="cartridge-label">üéÆ 8-BIT ULTIMATE üéÆ</div>
        
        <div class="led-panel">
            <span class="led">üî¥ POWER</span>
            <span class="led">üü° BOOST</span>
            <span class="led">üü¢ READY</span>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="mainScreen">
            <div class="score-panel">
                <span class="coin-sprite">üí∞</span>
                <span class="score-value" id="coinDisplay">0000</span>
            </div>
            
            <div class="tree-area" id="treeClick">
                <span class="tree-sprite" id="treeEmoji">üå±</span>
                <div id="hitEffect" class="hit-flash" style="display: none;"></div>
            </div>
            
            <div class="energy-container">
                <div class="energy-header">
                    <span>üîã ENERGY</span>
                    <span id="energyDisplay">200/200</span>
                </div>
                <div class="energy-track">
                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="stats-line">
                <span>‚ö° TAP: <span id="tapPower">1</span>x</span>
                <span id="critDisplay">üéØ –ö–†–ò–¢: 0%</span>
                <span>ü§ñ –ê–í–¢–û: <span id="autoStatus">–í–´–ö–õ</span></span>
            </div>
            
            <div class="power-indicator">
                üí∞ –ó–ê –ö–õ–ò–ö: <span id="earnPerTap">1</span> –ú–û–ù–ï–¢
            </div>
            
            <div class="crit-indicator" id="critMessage" style="display: none;">
                üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–î–ê–† –ì–û–¢–û–í! üéØ
            </div>
        </div>
        
        <!-- –ú–ê–ì–ê–ó–ò–ù –ë–£–°–¢–û–í (8 —É–ª—É—á—à–µ–Ω–∏–π) -->
        <div id="shopScreen" class="hidden">
            <div class="shop-container">
                <!-- 1. –≠–≤–æ–ª—é—Ü–∏—è –¥–µ—Ä–µ–≤–∞ -->
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üå± –≠–í–û–õ–Æ–¶–ò–Ø</h3>
                        <div class="item-desc">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞ +0.5 –∑–∞ —É—Ä–æ–≤–µ–Ω—å</div>
                        <div class="item-price" id="evoPrice">2000</div>
                        <div class="item-level" id="evoLevel">–£–†–û–í–ï–ù–¨ 0/6</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('evo')">–ê–ü</button>
                </div>
                
                <!-- 2. –°–∏–ª–∞ —Ç–∞–ø–∞ -->
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üí™ –°–ò–õ–ê –¢–ê–ü–ê</h3>
                        <div class="item-desc">+1 –º–æ–Ω–µ—Ç–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å</div>
                        <div class="item-price" id="tapPrice">100</div>
                        <div class="item-level" id="tapLevel">–£–†–û–í–ï–ù–¨ 1/25</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('tap')">–ê–ü</button>
                </div>
                
                <!-- 3. –ú–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è -->
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üîã –ú–ê–ö–° –≠–ù–ï–†–ì–ò–Ø</h3>
                        <div class="item-desc">+100 –∫ –ª–∏–º–∏—Ç—É</div>
                        <div class="item-price" id="energyPrice">100</div>
                        <div class="item-level" id="energyLevel">200/1200</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('energy')">–ê–ü</button>
                </div>
                
                <!-- 4. –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–ù–û–í–û–ï!) -->
                <div class="shop-item special">
                    <div class="item-info">
                        <h3>‚ö° –†–ï–ì–ï–ù–ï–†–ê–¶–ò–Ø</h3>
                        <div class="item-desc">–°–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å—Å—Ç. —ç–Ω–µ—Ä–≥–∏–∏</div>
                        <div class="item-price" id="regenPrice">1000</div>
                        <div class="item-level" id="regenLevel">0.15/—Å–µ–∫</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('regen')">–ê–ü</button>
                </div>
                
                <!-- 5. –ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä (–ù–û–í–û–ï!) -->
                <div class="shop-item special">
                    <div class="item-info">
                        <h3>ü§ñ –ê–í–¢–û-–ö–õ–ò–ö–ï–†</h3>
                        <div class="item-desc">1 –∫–ª–∏–∫/—Å–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–æ–º</div>
                        <div class="item-price" id="autoPrice">5000</div>
                        <div class="item-level" id="autoLevel">0/5 —É—Ä</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('auto')">–ê–ü</button>
                </div>
                
                <!-- 6. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä (–ù–û–í–û–ï!) -->
                <div class="shop-item special">
                    <div class="item-info">
                        <h3>üéØ –ö–†–ò–¢ –£–î–ê–†</h3>
                        <div class="item-desc">–®–∞–Ω—Å x3 —É—Ä–æ–Ω–∞</div>
                        <div class="item-price" id="critPrice">2000</div>
                        <div class="item-level" id="critLevel">0%</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('crit')">–ê–ü</button>
                </div>
                
                <!-- 7. –î–≤–æ–π–Ω–æ–π –¥–æ—Ö–æ–¥ (–ù–û–í–û–ï!) -->
                <div class="shop-item vip">
                    <div class="item-info">
                        <h3>üí∞ –î–í–û–ô–ù–û–ô –î–û–•–û–î</h3>
                        <div class="item-desc">–í–°–Å x2 (–ø–∞—Å—Å–∏–≤+—Ç–∞–ø)</div>
                        <div class="item-price">10000</div>
                        <div class="item-level" id="multiplierLevel">x1</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('multiplier')">–ê–ü</button>
                </div>
                
                <!-- 8. –ú–∞–∫—Å–∏–º—É–º (VIP) -->
                <div class="shop-item vip">
                    <div class="item-info">
                        <h3>üëë –ú–ê–ö–°–ò–ú–£–ú</h3>
                        <div class="item-desc">–í–°–Å x5 + –∑–æ–ª–æ—Ç–æ–µ –¥–µ—Ä–µ–≤–æ</div>
                        <div class="item-price">50000</div>
                        <div class="item-level">VIP</div>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('max')">–ê–ü</button>
                </div>
            </div>
        </div>
        
        <!-- –î—Ä—É–∑—å—è -->
        <div id="friendsScreen" class="hidden">
            <div class="friends-area">
                <button class="invite-btn" onclick="inviteFriend()">
                    üîó –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê
                </button>
                <div class="friend-counter" id="friendCount">
                    –î–†–£–ó–ï–ô: 0
                </div>
                <div style="color: #7fffd4; font-size: 8px; margin-top: 15px;">
                    +500 –ó–ê –ö–ê–ñ–î–û–ì–û –î–†–£–ì–ê
                </div>
            </div>
        </div>
        
        <!-- –ú–µ–Ω—é -->
        <div class="menu-buttons">
            <button class="menu-btn active" onclick="showScreen('main', this)">üå≥ –ò–ì–†–ê</button>
            <button class="menu-btn" onclick="showScreen('shop', this)">üöÄ –ë–£–°–¢–´</button>
            <button class="menu-btn" onclick="showScreen('friends', this)">üë• –î–†–£–ó–¨–Ø</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        
        const userId = tg.initDataUnsafe?.user?.id || 'guest_' + Math.random();
        const userName = tg.initDataUnsafe?.user?.first_name || '–ò–ì–†–û–ö';
        
        const SAVE_KEY = 'money_tree_ultimate_' + userId;
        const WELCOME_KEY = 'welcome_ultimate_' + userId;
        
        // –†–ê–°–®–ò–†–ï–ù–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´
        let gameState = {
            coins: 0,
            tapPower: 1,
            energy: 200,
            maxEnergy: 200,
            passiveIncome: 0,
            treeLevel: 0,
            referrals: [],
            
            // –ù–û–í–´–ï –ë–£–°–¢–´
            regenLevel: 0,        // —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (0-5)
            autoClickerLevel: 0,   // –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä (0-5)
            critLevel: 0,          // —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ (0-10)
            multiplier: 1,          // –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞ (1-5)
            
            lastAutoTick: Date.now()
        };
        
        const treeStages = ['üå±', 'üåø', 'üå≥', 'üå≤', 'üéÑ', 'üëëüå≥'];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞
        try {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                const loaded = JSON.parse(saved);
                gameState = {...gameState, ...loaded};
            }
        } catch (e) {}
        
        // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        const bootScreen = document.getElementById('bootScreen');
        const welcomeShown = localStorage.getItem(WELCOME_KEY);
        
        if (welcomeShown) {
            bootScreen.style.display = 'none';
        } else {
            document.getElementById('bootMessage').innerHTML = `–ü–†–ò–í–ï–¢,<br>${userName}!<br>+500 –ë–û–ù–£–°`;
        }
        
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!welcomeShown) {
                gameState.coins += 500;
                localStorage.setItem(WELCOME_KEY, 'true');
                playSound('coin');
            }
            
            bootScreen.style.opacity = '0';
            setTimeout(() => {
                bootScreen.style.display = 'none';
            }, 300);
            
            updateDisplay();
        });
        
        // –†–µ—Ñ–µ—Ä–∞–ª–∫–∞
        const urlParams = new URLSearchParams(window.location.search);
        const refId = urlParams.get('startapp');
        
        if (refId && refId !== userId && !localStorage.getItem('ref_' + userId)) {
            gameState.coins += 500;
            gameState.referrals.push(refId);
            localStorage.setItem('ref_' + userId, 'true');
        }
        
        // –ó–≤—É–∫–∏
        function playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const ctx = new AudioContext();
            
            if (type === 'coin') {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(660, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.2);
            }
            
            if (type === 'click') {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(220, ctx.currentTime);
                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            }
            
            if (type === 'buy') {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(330, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.1);
                osc.frequency.exponentialRampToValueAtTime(554, ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            }
            
            if (type === 'error') {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(110, ctx.currentTime);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.15);
            }
            
            if (type === 'crit') {
                const osc1 = ctx.createOscillator();
                const osc2 = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc1.type = 'square';
                osc2.type = 'triangle';
                
                osc1.frequency.setValueAtTime(880, ctx.currentTime);
                osc2.frequency.setValueAtTime(440, ctx.currentTime);
                
                gain.gain.setValueAtTime(0.15, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                
                osc1.connect(gain);
                osc2.connect(gain);
                gain.connect(ctx.destination);
                
                osc1.start();
                osc2.start();
                osc1.stop(ctx.currentTime + 0.3);
                osc2.stop(ctx.currentTime + 0.3);
            }
        }
        
        // –†–∞—Å—á–µ—Ç —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        function getRegenRate() {
            return 0.15 + (gameState.regenLevel * 0.1); // 0.15, 0.25, 0.35, 0.45, 0.55, 0.65
        }
        
        // –†–∞—Å—á–µ—Ç —à–∞–Ω—Å–∞ –∫—Ä–∏—Ç–∞
        function getCritChance() {
            return gameState.critLevel * 3; // 0%, 3%, 6%, 9%, 12%, 15%...
        }
        
        // –†–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–∞ –∑–∞ –∫–ª–∏–∫
        function getEarnPerTap() {
            let base = gameState.tapPower * (1 + gameState.treeLevel * 0.5);
            return base * gameState.multiplier;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
        function updateDisplay() {
            const coinsStr = Math.floor(gameState.coins).toString().padStart(4, '0').slice(-4);
            document.getElementById('coinDisplay').textContent = coinsStr;
            
            document.getElementById('energyDisplay').textContent = 
                Math.floor(gameState.energy) + '/' + gameState.maxEnergy;
            
            const percent = (gameState.energy / gameState.maxEnergy) * 100;
            document.getElementById('energyFill').style.width = percent + '%';
            
            document.getElementById('treeEmoji').textContent = treeStages[gameState.treeLevel];
            document.getElementById('tapPower').textContent = gameState.tapPower;
            document.getElementById('earnPerTap').textContent = Math.floor(getEarnPerTap());
            document.getElementById('critDisplay').textContent = `üéØ –ö–†–ò–¢: ${getCritChance()}%`;
            document.getElementById('autoStatus').textContent = gameState.autoClickerLevel > 0 ? gameState.autoClickerLevel + '–£–†' : '–í–´–ö–õ';
            
            // –¶–µ–Ω—ã –∏ —É—Ä–æ–≤–Ω–∏
            document.getElementById('evoPrice').textContent = (gameState.treeLevel + 1) * 2000;
            document.getElementById('evoLevel').textContent = `–£–†–û–í–ï–ù–¨ ${gameState.treeLevel}/6`;
            
            document.getElementById('tapPrice').textContent = Math.floor(100 * Math.pow(1.5, gameState.tapPower - 1));
            document.getElementById('tapLevel').textContent = `–£–†–û–í–ï–ù–¨ ${gameState.tapPower}/25`;
            
            document.getElementById('energyPrice').textContent = gameState.maxEnergy;
            document.getElementById('energyLevel').textContent = `${gameState.maxEnergy}/1200`;
            
            document.getElementById('regenPrice').textContent = 1000 * (gameState.regenLevel + 1);
            document.getElementById('regenLevel').textContent = getRegenRate().toFixed(2) + '/—Å–µ–∫';
            
            document.getElementById('autoPrice').textContent = 5000 * (gameState.autoClickerLevel + 1);
            document.getElementById('autoLevel').textContent = `${gameState.autoClickerLevel}/5 —É—Ä`;
            
            document.getElementById('critPrice').textContent = 2000 * (gameState.critLevel + 1);
            document.getElementById('critLevel').textContent = getCritChance() + '%';
            
            document.getElementById('multiplierLevel').textContent = 'x' + gameState.multiplier;
            document.getElementById('friendCount').textContent = '–î–†–£–ó–ï–ô: ' + gameState.referrals.length;
            
            if (getCritChance() > 0) {
                document.getElementById('critMessage').style.display = 'block';
            }
            
            localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        }
        
        // –ö–õ–ò–ö –ü–û –î–ï–†–ï–í–£
        document.getElementById('treeClick').addEventListener('click', function(e) {
            if (gameState.energy < 1) {
                playSound('error');
                tg.HapticFeedback.notificationOccurred('warning');
                return;
            }
            
            playSound('click');
            
            const hit = document.getElementById('hitEffect');
            hit.style.display = 'block';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∏—Ç
            const isCrit = Math.random() * 100 < getCritChance();
            let earn = getEarnPerTap();
            
            if (isCrit) {
                earn *= 3;
                hit.classList.add('crit');
                playSound('crit');
                tg.HapticFeedback.impactOccurred('heavy');
            } else {
                hit.classList.remove('crit');
                tg.HapticFeedback.impactOccurred('medium');
            }
            
            gameState.coins += earn;
            gameState.energy -= 1;
            
            setTimeout(() => hit.style.display = 'none', 100);
            
            // –ü–æ–ø–∞–ø
            const popup = document.createElement('div');
            popup.className = 'popup-8bit' + (isCrit ? ' popup-crit' : '');
            popup.textContent = (isCrit ? 'üéØ ' : '+') + Math.floor(earn);
            
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            
            if (clientX && clientY) {
                popup.style.left = clientX + 'px';
                popup.style.top = clientY + 'px';
                document.body.appendChild(popup);
                setTimeout(() => popup.remove(), 600);
            }
            
            updateDisplay();
        });
        
        // –ü–û–ö–£–ü–ö–ò
        window.buyUpgrade = function(type) {
            let cost = 0;
            
            switch(type) {
                case 'evo':
                    if (gameState.treeLevel >= 5) return;
                    cost = (gameState.treeLevel + 1) * 2000;
                    break;
                case 'tap':
                    if (gameState.tapPower >= 25) return;
                    cost = Math.floor(100 * Math.pow(1.5, gameState.tapPower - 1));
                    break;
                case 'energy':
                    if (gameState.maxEnergy >= 1200) return;
                    cost = gameState.maxEnergy;
                    break;
                case 'regen':
                    if (gameState.regenLevel >= 5) return;
                    cost = 1000 * (gameState.regenLevel + 1);
                    break;
                case 'auto':
                    if (gameState.autoClickerLevel >= 5) return;
                    cost = 5000 * (gameState.autoClickerLevel + 1);
                    break;
                case 'crit':
                    if (gameState.critLevel >= 10) return;
                    cost = 2000 * (gameState.critLevel + 1);
                    break;
                case 'multiplier':
                    if (gameState.multiplier >= 5) return;
                    cost = 10000;
                    break;
                case 'max':
                    if (gameState.multiplier >= 5) return;
                    cost = 50000;
                    break;
            }
            
            if (gameState.coins >= cost) {
                gameState.coins -= cost;
                
                switch(type) {
                    case 'evo': gameState.treeLevel++; break;
                    case 'tap': gameState.tapPower++; break;
                    case 'energy': 
                        gameState.maxEnergy += 100; 
                        gameState.energy = gameState.maxEnergy;
                        break;
                    case 'regen': gameState.regenLevel++; break;
                    case 'auto': gameState.autoClickerLevel++; break;
                    case 'crit': gameState.critLevel++; break;
                    case 'multiplier': gameState.multiplier = 2; break;
                    case 'max': 
                        gameState.multiplier = 5;
                        gameState.treeLevel = 5;
                        break;
                }
                
                playSound('buy');
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                playSound('error');
                tg.HapticFeedback.notificationOccurred('error');
            }
            
            updateDisplay();
        };
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        window.showScreen = function(screen, btn) {
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('shopScreen').classList.add('hidden');
            document.getElementById('friendsScreen').classList.add('hidden');
            
            document.getElementById(screen + 'Screen').classList.remove('hidden');
        };
        
        // –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞
        window.inviteFriend = function() {
            const botName = 'YOUR_BOT_NAME'; // –ó–ê–ú–ï–ù–ò
            const link = `https://t.me/${botName}/app?startapp=${userId}`;
            
            tg.openTelegramLink(
                'https://t.me/share/url?url=' + encodeURIComponent(link) + 
                '&text=üå≥ –ü–†–ò–°–û–ï–î–ò–ù–Ø–ô–°–Ø –ö MONEY TREE ULTIMATE! –°–¢–ê–†–¢–û–í–´–ô –ë–û–ù–£–° 500 –ú–û–ù–ï–¢!'
            );
            
            playSound('click');
        };
        
        // –ê–í–¢–û-–ö–õ–ò–ö–ï–† –ò –†–ï–ì–ï–ù–ï–†–ê–¶–ò–Ø
        setInterval(() => {
            // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏
            if (gameState.energy < gameState.maxEnergy) {
                gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + getRegenRate() / 10);
            }
            
            // –ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä
            if (gameState.autoClickerLevel > 0) {
                const now = Date.now();
                if (now - gameState.lastAutoTick > 1000) {
                    gameState.lastAutoTick = now;
                    
                    if (gameState.energy >= 1) {
                        gameState.energy -= 1;
                        gameState.coins += getEarnPerTap() * gameState.autoClickerLevel * 0.3;
                        
                        // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä–∞
                        if (Math.random() < 0.1) {
                            const treeRect = document.getElementById('treeClick').getBoundingClientRect();
                            const popup = document.createElement('div');
                            popup.className = 'popup-8bit';
                            popup.style.fontSize = '14px';
                            popup.textContent = 'ü§ñ ' + Math.floor(getEarnPerTap() * gameState.autoClickerLevel * 0.3);
                            popup.style.left = treeRect.left + 50 + 'px';
                            popup.style.top = treeRect.top + 'px';
                            document.body.appendChild(popup);
                            setTimeout(() => popup.remove(), 500);
                        }
                    }
                }
            }
            
            // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
            if (gameState.passiveIncome > 0) {
                gameState.coins += (gameState.passiveIncome * (1 + gameState.treeLevel * 0.5) * gameState.multiplier) / 100;
            }
            
            updateDisplay();
        }, 100);
        
        // –°—Ç–∞—Ä—Ç
        showScreen('main', document.querySelector('.menu-btn'));
        updateDisplay();
    </script>
</body>
</html>
