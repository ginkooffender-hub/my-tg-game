<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MONEY TREE ‚ö° 8-BIT</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        body {
            min-height: 100vh;
            background: #1a1a2e;
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            position: relative;
            overflow: hidden;
        }
        
        /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Ñ–æ–Ω */
        body::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(255, 215, 0, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 215, 0, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
            animation: bgMove 20s linear infinite;
        }
        
        @keyframes bgMove {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }
        
        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Å—Ç–∏–ª–µ Dendy */
        .gameboy {
            width: 100%;
            max-width: 450px;
            background: #16213e;
            border: 8px solid #0f3460;
            border-radius: 30px 30px 20px 20px;
            padding: 20px 15px;
            position: relative;
            box-shadow: 
                0 0 0 4px #e94560,
                0 20px 0 #0a1a2f,
                0 30px 30px rgba(0,0,0,0.5);
            z-index: 10;
        }
        
        /* –≠–∫—Ä–∞–Ω */
        .screen {
            background: #0f172a;
            border: 6px solid #533483;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            position: relative;
        }
        
        /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–π –±–æ—Ä–¥—é—Ä */
        .screen::before {
            content: "";
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid #ffd700;
            border-radius: 25px;
            opacity: 0.3;
            pointer-events: none;
        }
        
        /* –°—á–µ—Ç—á–∏–∫ –º–æ–Ω–µ—Ç */
        .coin-display {
            background: #000000;
            border: 4px solid #ffd700;
            padding: 15px 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 4px 0 #b8860b;
        }
        
        .coin-icon {
            font-size: 24px;
            filter: drop-shadow(0 0 10px gold);
            animation: coinGlow 1.5s infinite;
        }
        
        @keyframes coinGlow {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px gold); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 20px gold); }
        }
        
        .coin-value {
            color: #ffd700;
            font-size: 24px;
            text-shadow: 3px 3px 0 #b8860b;
            letter-spacing: 2px;
        }
        
        /* –î–µ—Ä–µ–≤–æ –≤ —Å—Ç–∏–ª–µ 8-bit */
        .tree-pixel {
            background: #2a5c3e;
            border: 4px solid #1e3a2a;
            padding: 30px 20px;
            margin: 20px 0;
            text-align: center;
            cursor: pointer;
            position: relative;
            box-shadow: 
                0 8px 0 #1e3a2a,
                inset 0 -5px 0 #3d7a4a;
            transition: all 0.05s linear;
            image-rendering: pixelated;
        }
        
        .tree-pixel:active {
            transform: translateY(8px);
            box-shadow: 
                0 0 0 #1e3a2a,
                inset 0 -5px 0 #3d7a4a;
        }
        
        .tree-emoji {
            font-size: 100px;
            display: block;
            filter: drop-shadow(0 10px 0 #1e3a2a);
            animation: treeWiggle 2s infinite;
        }
        
        @keyframes treeWiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(2deg); }
            75% { transform: rotate(-2deg); }
        }
        
        /* –ü–∏–∫—Å–µ–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è */
        .energy-pixel {
            margin: 20px 0;
            background: #1e1e3f;
            border: 4px solid #4a4a8a;
            padding: 15px;
        }
        
        .energy-label {
            color: #7fffd4;
            font-size: 12px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #008b8b;
            display: flex;
            justify-content: space-between;
        }
        
        .energy-bar-bg {
            background: #2a2a5a;
            height: 25px;
            border: 3px solid #4a4a8a;
            position: relative;
            image-rendering: pixelated;
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #7fffd4, #40e0d0);
            width: 100%;
            box-shadow: inset 0 2px 0 #b0ffff;
            image-rendering: pixelated;
        }
        
        /* –ú–µ–Ω—é –≤ —Å—Ç–∏–ª–µ Dendy */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .menu-button {
            background: #e94560;
            border: none;
            border-bottom: 6px solid #a02040;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            padding: 15px 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.05s linear;
            text-shadow: 2px 2px 0 #4a0a2a;
            box-shadow: 0 4px 0 #4a0a2a;
        }
        
        .menu-button:active {
            transform: translateY(6px);
            border-bottom-width: 2px;
            box-shadow: 0 2px 0 #4a0a2a;
        }
        
        .menu-button.active {
            background: #ffd700;
            color: #000;
            text-shadow: 2px 2px 0 #b8860b;
            border-bottom-color: #b8860b;
        }
        
        /* –ú–∞–≥–∞–∑–∏–Ω –≤ –ø–∏–∫—Å–µ–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ */
        .shop-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 350px;
            overflow-y: auto;
            padding: 5px;
            scrollbar-width: none;
        }
        
        .shop-item {
            background: #2a2a5a;
            border: 4px solid #4a4a8a;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            image-rendering: pixelated;
        }
        
        .shop-item-info h4 {
            color: #ffd700;
            font-size: 12px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 0 #b8860b;
        }
        
        .shop-item-price {
            color: #7fffd4;
            font-size: 12px;
        }
        
        .shop-button {
            background: #ffd700;
            border: none;
            border-bottom: 4px solid #b8860b;
            color: #000;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.05s linear;
        }
        
        .shop-button:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        
        /* –î—Ä—É–∑—å—è */
        .friends-panel {
            background: #2a2a5a;
            border: 4px solid #4a4a8a;
            padding: 20px;
            text-align: center;
        }
        
        .ref-button {
            background: #7fffd4;
            border: none;
            border-bottom: 6px solid #40e0d0;
            color: #000;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            padding: 20px;
            width: 100%;
            cursor: pointer;
            margin: 20px 0;
            text-shadow: 2px 2px 0 #20b2aa;
        }
        
        .ref-count {
            color: #ffd700;
            font-size: 12px;
            margin-top: 15px;
            text-shadow: 2px 2px 0 #b8860b;
        }
        
        /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–µ –ø–æ–ø–∞–ø—ã */
        .pixel-popup {
            position: fixed;
            color: #ffd700;
            font-family: 'Press Start 2P', cursive;
            font-size: 20px;
            pointer-events: none;
            z-index: 1000;
            text-shadow: 
                3px 3px 0 #b8860b,
                -2px -2px 0 #ffa500;
            animation: pixelFloat 1s steps(5) forwards;
            image-rendering: pixelated;
        }
        
        @keyframes pixelFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-120px) scale(1.5); opacity: 0; }
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç—ã */
        .hidden {
            display: none;
        }
        
        /* –ü–∏–∫—Å–µ–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —É–¥–∞—Ä–∞ */
        .hit-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 215, 0, 0.3);
            animation: hitFlash 0.1s steps(2);
            pointer-events: none;
        }
        
        @keyframes hitFlash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 30, 0.95);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.3s steps(5);
        }
        
        .welcome-box {
            background: #16213e;
            border: 8px solid #e94560;
            padding: 40px 30px;
            text-align: center;
            max-width: 350px;
            width: 90%;
            box-shadow: 0 20px 0 #0a1a2f;
        }
        
        .welcome-title {
            color: #ffd700;
            font-size: 20px;
            margin-bottom: 20px;
            text-shadow: 4px 4px 0 #b8860b;
            line-height: 1.4;
        }
        
        .welcome-8bit {
            font-size: 60px;
            margin: 20px 0;
            filter: drop-shadow(0 10px 0 #1e3a2a);
            animation: welcomeBob 1s steps(5) infinite;
        }
        
        @keyframes welcomeBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .welcome-text {
            color: #7fffd4;
            font-size: 12px;
            margin: 25px 0;
            line-height: 1.8;
        }
        
        .start-button {
            background: #e94560;
            border: none;
            border-bottom: 8px solid #a02040;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            padding: 20px 30px;
            width: 100%;
            cursor: pointer;
            margin-top: 20px;
            text-shadow: 3px 3px 0 #4a0a2a;
        }
        
        .start-button:active {
            transform: translateY(8px);
            border-bottom-width: 4px;
        }
        
        /* –£–∫—Ä–∞—à–µ–Ω–∏—è */
        .pixel-decor {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            color: #4a4a8a;
            font-size: 8px;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—Ä–µ–ª–∏–≤–∞ */
        .glitch-text {
            animation: glitch 3s infinite;
        }
        
        @keyframes glitch {
            0%, 100% { text-shadow: 3px 3px 0 #b8860b; }
            25% { text-shadow: -3px 3px 0 #e94560, 3px -3px 0 #7fffd4; }
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω –≤ —Å—Ç–∏–ª–µ Dendy -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-box">
            <div class="welcome-title glitch-text">üí∞ MONEY TREE üí∞</div>
            <div class="welcome-8bit" id="welcomeEmoji">üå±</div>
            <div class="welcome-text" id="welcomeMessage">
                –ó–ê–ì–†–£–ó–ö–ê...
            </div>
            <div class="pixel-decor">
                <span>‚ö°</span>
                <span>‚ö°‚ö°‚ö°</span>
                <span>‚ö°</span>
            </div>
            <button class="start-button" id="startGameBtn">
                START
            </button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
    <div class="gameboy">
        <!-- –í–µ—Ä—Ö–Ω–∏–µ –ø–∏–∫—Å–µ–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
        <div class="pixel-decor">
            <span>üî¥</span>
            <span>üü°</span>
            <span>üü¢</span>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω -->
        <div class="screen">
            <!-- –ú–æ–Ω–µ—Ç—ã -->
            <div class="coin-display">
                <span class="coin-icon">üí∞</span>
                <span class="coin-value" id="coinDisplay">0000</span>
            </div>
            
            <!-- –î–µ—Ä–µ–≤–æ (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–µ) -->
            <div class="tree-pixel" id="treeClick">
                <span class="tree-emoji" id="treeEmoji">üå±</span>
                <div id="hitEffect" class="hit-effect" style="display: none;"></div>
            </div>
            
            <!-- –≠–Ω–µ—Ä–≥–∏—è -->
            <div class="energy-pixel">
                <div class="energy-label">
                    <span>üîã ENERGY</span>
                    <span id="energyDisplay">100/100</span>
                </div>
                <div class="energy-bar-bg">
                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                </div>
            </div>
            
            <!-- –ú–µ–Ω—é (—Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏) -->
            <div class="menu-grid">
                <button class="menu-button active" onclick="showScreen('main')">üå≥ PLAY</button>
                <button class="menu-button" onclick="showScreen('shop')">üè™ SHOP</button>
                <button class="menu-button" onclick="showScreen('friends')">üë• FRIENDS</button>
            </div>
            
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã -->
            
            <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (–∏–Ω—Ñ–æ) -->
            <div id="mainScreen">
                <div style="color: #7fffd4; font-size: 8px; text-align: center; margin: 10px 0;">
                    ‚ö° TAP POWER: <span id="tapPower">1</span>x ‚ö°
                </div>
            </div>
            
            <!-- –ú–∞–≥–∞–∑–∏–Ω -->
            <div id="shopScreen" class="hidden">
                <div class="shop-grid">
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <h4>üå≥ EVOLVE</h4>
                            <span class="shop-item-price" id="evoPrice">2000</span>
                        </div>
                        <button class="shop-button" onclick="buyUpgrade('evo')">BUY</button>
                    </div>
                    
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <h4>üí™ TAP POWER</h4>
                            <span class="shop-item-price" id="tapPrice">100</span>
                        </div>
                        <button class="shop-button" onclick="buyUpgrade('tap')">BUY</button>
                    </div>
                    
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <h4>üîã MAX ENERGY</h4>
                            <span class="shop-item-price" id="energyPrice">50</span>
                        </div>
                        <button class="shop-button" onclick="buyUpgrade('energy')">BUY</button>
                    </div>
                    
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <h4>ü§ñ AUTO FARM</h4>
                            <span class="shop-item-price" id="passivePrice">500</span>
                        </div>
                        <button class="shop-button" onclick="buyUpgrade('passive')">BUY</button>
                    </div>
                </div>
            </div>
            
            <!-- –î—Ä—É–∑—å—è -->
            <div id="friendsScreen" class="hidden">
                <div class="friends-panel">
                    <button class="ref-button" onclick="inviteFriend()">
                        üîó INVITE FRIEND
                    </button>
                    <div class="ref-count" id="friendCount">
                        FRIENDS: 0
                    </div>
                    <div style="color: #7fffd4; font-size: 8px; margin-top: 15px;">
                        +500 COINS PER FRIEND
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å (–∫–∞–∫ –Ω–∞ Dendy) -->
        <div class="pixel-decor" style="margin-top: 15px;">
            <span>‚óÄ</span>
            <span>‚ñ∂</span>
            <span>SELECT</span>
            <span>START</span>
            <span>‚óÄ</span>
            <span>‚ñ∂</span>
        </div>
    </div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userId = tg.initDataUnsafe?.user?.id || 'guest_' + Math.random();
        const userName = tg.initDataUnsafe?.user?.first_name || 'PLAYER';
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const SAVE_KEY = 'money_tree_8bit_' + userId;
        const WELCOME_KEY = 'welcome_8bit_' + userId;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            coins: 0,
            tapPower: 1,
            energy: 100,
            maxEnergy: 100,
            passiveIncome: 0,
            treeLevel: 0,
            referrals: []
        };
        
        // –ü–∏–∫—Å–µ–ª—å–Ω—ã–µ –¥–µ—Ä–µ–≤—å—è
        const treeStages = ['üå±', 'üåø', 'üå≥', 'üå≤', 'üéÑ', 'üëëüå≥'];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞
        try {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                gameState = {...gameState, ...JSON.parse(saved)};
            }
        } catch (e) {}
        
        // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        const welcomeScreen = document.getElementById('welcomeScreen');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const welcomeEmoji = document.getElementById('welcomeEmoji');
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥
        const welcomeShown = localStorage.getItem(WELCOME_KEY);
        
        if (welcomeShown) {
            welcomeScreen.style.display = 'none';
        } else {
            welcomeMessage.innerHTML = `HELLO<br>${userName}!<br>+500 BONUS`;
            welcomeEmoji.textContent = 'üí∞';
        }
        
        // –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞
        document.getElementById('startGameBtn').addEventListener('click', () => {
            if (!welcomeShown) {
                gameState.coins += 500;
                localStorage.setItem(WELCOME_KEY, 'true');
                tg.HapticFeedback.notificationOccurred('success');
            }
            
            welcomeScreen.style.opacity = '0';
            setTimeout(() => {
                welcomeScreen.style.display = 'none';
            }, 300);
            
            updateDisplay();
        });
        
        // –†–µ—Ñ–µ—Ä–∞–ª–∫–∞
        const urlParams = new URLSearchParams(window.location.search);
        const refId = urlParams.get('startapp');
        
        if (refId && refId !== userId && !localStorage.getItem('ref_' + userId)) {
            gameState.coins += 500;
            gameState.referrals.push(refId);
            localStorage.setItem('ref_' + userId, 'true');
            
            setTimeout(() => {
                tg.showPopup({
                    title: 'BONUS!',
                    message: '+500 COINS FOR FRIEND INVITE',
                    buttons: [{ type: 'ok' }]
                });
            }, 1000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
        function updateDisplay() {
            // –ú–æ–Ω–µ—Ç—ã (—Å –≤–µ–¥—É—â–∏–º–∏ –Ω—É–ª—è–º–∏)
            const coinsStr = Math.floor(gameState.coins).toString().padStart(4, '0').slice(-4);
            document.getElementById('coinDisplay').textContent = coinsStr;
            
            // –≠–Ω–µ—Ä–≥–∏—è
            document.getElementById('energyDisplay').textContent = 
                Math.floor(gameState.energy) + '/' + gameState.maxEnergy;
            
            const percent = (gameState.energy / gameState.maxEnergy) * 100;
            document.getElementById('energyFill').style.width = percent + '%';
            
            // –î–µ—Ä–µ–≤–æ
            document.getElementById('treeEmoji').textContent = treeStages[gameState.treeLevel];
            
            // –°–∏–ª–∞ —Ç–∞–ø–∞
            document.getElementById('tapPower').textContent = gameState.tapPower;
            
            // –¶–µ–Ω—ã
            document.getElementById('evoPrice').textContent = (gameState.treeLevel + 1) * 2000;
            document.getElementById('tapPrice').textContent = 
                Math.floor(100 * Math.pow(1.5, gameState.tapPower - 1));
            document.getElementById('energyPrice').textContent = gameState.maxEnergy;
            document.getElementById('passivePrice').textContent = (gameState.passiveIncome + 1) * 500;
            
            // –î—Ä—É–∑—å—è
            document.getElementById('friendCount').textContent = 'FRIENDS: ' + gameState.referrals.length;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        }
        
        // –ö–ª–∏–∫ –ø–æ –¥–µ—Ä–µ–≤—É
        document.getElementById('treeClick').addEventListener('click', function(e) {
            if (gameState.energy < 1) {
                tg.HapticFeedback.notificationOccurred('warning');
                return;
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç —É–¥–∞—Ä–∞
            const hit = document.getElementById('hitEffect');
            hit.style.display = 'block';
            setTimeout(() => hit.style.display = 'none', 100);
            
            // –ó–∞—Ä–∞–±–æ—Ç–æ–∫
            const earn = gameState.tapPower * (1 + gameState.treeLevel * 0.5);
            gameState.coins += earn;
            gameState.energy -= 1;
            
            // –í–∏–±—Ä–∞—Ü–∏—è
            tg.HapticFeedback.impactOccurred('heavy');
            
            // –ü–∏–∫—Å–µ–ª—å–Ω—ã–π –ø–æ–ø-–∞–ø
            const popup = document.createElement('div');
            popup.className = 'pixel-popup';
            popup.textContent = '+' + Math.floor(earn);
            popup.style.left = (e.clientX || e.touches[0].clientX) + 'px';
            popup.style.top = (e.clientY || e.touches[0].clientY) + 'px';
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 500);
            
            updateDisplay();
        });
        
        // –ü–æ–∫—É–ø–∫–∏
        window.buyUpgrade = function(type) {
            let cost = 0;
            
            switch(type) {
                case 'evo':
                    if (gameState.treeLevel >= 5) {
                        tg.showPopup({ title: 'MAX', message: 'MAX LEVEL REACHED!' });
                        return;
                    }
                    cost = (gameState.treeLevel + 1) * 2000;
                    break;
                case 'tap':
                    cost = Math.floor(100 * Math.pow(1.5, gameState.tapPower - 1));
                    break;
                case 'energy':
                    cost = gameState.maxEnergy;
                    break;
                case 'passive':
                    cost = (gameState.passiveIncome + 1) * 500;
                    break;
            }
            
            if (gameState.coins >= cost) {
                gameState.coins -= cost;
                
                switch(type) {
                    case 'evo': gameState.treeLevel++; break;
                    case 'tap': gameState.tapPower++; break;
                    case 'energy': 
                        gameState.maxEnergy += 50; 
                        gameState.energy = gameState.maxEnergy;
                        break;
                    case 'passive': gameState.passiveIncome += 0.5; break;
                }
                
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
            
            updateDisplay();
        };
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        window.showScreen = function(screen) {
            document.querySelectorAll('.menu-button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('shopScreen').classList.add('hidden');
            document.getElementById('friendsScreen').classList.add('hidden');
            
            document.getElementById(screen + 'Screen').classList.remove('hidden');
        };
        
        // –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞
        window.inviteFriend = function() {
            const botName = 'MONEY TREE'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞
            const link = `https://t.me/${botName}/app?startapp=${userId}`;
            
            tg.openTelegramLink(
                'https://t.me/share/url?url=' + encodeURIComponent(link) + 
                '&text=üå≥ JOIN ME IN MONEY TREE 8-BIT! GET 500 BONUS!'
            );
        };
        
        // –ê–≤—Ç–æ-—Ñ–∞—Ä–º –∏ —Ä–µ–≥–µ–Ω —ç–Ω–µ—Ä–≥–∏–∏
        setInterval(() => {
            if (gameState.passiveIncome > 0) {
                gameState.coins += (gameState.passiveIncome * (1 + gameState.treeLevel * 0.5)) / 10;
            }
            
            if (gameState.energy < gameState.maxEnergy) {
                gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + 0.3);
            }
            
            updateDisplay();
        }, 100);
        
        // –°—Ç–∞—Ä—Ç
        showScreen('main');
        updateDisplay();
    </script>
</body>
</html>
