<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Money Tree: Evolution</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #ffcf4d;
            --emerald: #2ecc71;
            --dark-blue: #0f172a;
            --glass: rgba(30, 41, 59, 0.7);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Montserrat', sans-serif;
            background: radial-gradient(circle at top, #1e293b, #020617);
            color: white; height: 100vh; overflow: hidden;
            display: flex; justify-content: center;
        }

        .app { width: 100%; max-width: 420px; display: flex; flex-direction: column; padding: 20px; position: relative; }

        /* –ë–∞–ª–∞–Ω—Å */
        .top-nav {
            background: var(--glass); backdrop-filter: blur(15px);
            padding: 15px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .balance-val { font-family: 'Bungee'; font-size: 38px; color: var(--gold); text-shadow: 0 4px 0 #b8860b; }
        .lvl-badge { font-size: 10px; background: var(--emerald); padding: 4px 12px; border-radius: 20px; text-transform: uppercase; font-weight: 800; }

        /* –ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ */
        .game-core { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        
        .tree-box { position: relative; transition: transform 0.1s; cursor: pointer; }
        .tree-img { font-size: 140px; filter: drop-shadow(0 0 30px rgba(46, 204, 113, 0.4)); animation: float 3s ease-in-out infinite; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        /* –≠–Ω–µ—Ä–≥–∏—è */
        .energy-box { width: 100%; margin-bottom: 20px; }
        .bar-outer { height: 16px; background: #111; border-radius: 10px; border: 1px solid #333; overflow: hidden; }
        .bar-inner { height: 100%; width: 100%; background: linear-gradient(90deg, #22c55e, #a8ff78); transition: width 0.2s; box-shadow: 0 0 15px var(--emerald); }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        .upgrades { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .up-card { 
            background: var(--glass); padding: 12px; border-radius: 18px; 
            border: 1px solid rgba(255,255,255,0.05); text-align: left;
        }
        .up-card:active { transform: scale(0.95); }
        .up-name { font-size: 11px; opacity: 0.7; font-weight: 800; }
        .up-cost { display: block; font-size: 16px; color: var(--gold); font-family: 'Bungee'; }

        /* –õ–µ—Ç–∞—é—â–∏–µ –º–æ–Ω–µ—Ç–∫–∏ */
        .tap-anim {
            position: absolute; color: var(--gold); font-family: 'Bungee';
            font-size: 24px; pointer-events: none; animation: flyUp 0.8s ease-out forwards;
        }
        @keyframes flyUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-120px); opacity: 0; } }
    </style>
</head>
<body>
    <div class="app">
        <div class="top-nav">
            <span class="lvl-badge" id="lvlName">–†–æ—Å—Ç–æ–∫</span>
            <div class="balance-val" id="coins">0</div>
            <div style="font-size: 12px; opacity: 0.5;">MONEY COINS</div>
        </div>

        <div class="game-core">
            <div class="tree-box" id="treeBtn">
                <div class="tree-img" id="mainTree">üå±</div>
            </div>
        </div>

        <div class="energy-box">
            <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
                <span>–≠–ù–ï–†–ì–ò–Ø</span>
                <span id="energyText">100/100</span>
            </div>
            <div class="bar-outer"><div class="bar-inner" id="energyFill"></div></div>
        </div>

        <div class="upgrades">
            <div class="up-card" onclick="buy('tap')">
                <span class="up-name">–°–ò–õ–ê –¢–ê–ü–ê</span>
                <span class="up-cost" id="tapCost">50</span>
            </div>
            <div class="up-card" onclick="buy('energy')">
                <span class="up-name">–ú–ê–ö–° –≠–ù–ï–†–ì–ò–Ø</span>
                <span class="up-cost" id="energyCost">100</span>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let state = JSON.parse(localStorage.getItem('mTree_v1')) || {
            coins: 0, power: 1, energy: 100, maxEnergy: 100, lvl: 1
        };

        const trees = ["üå±", "üåø", "üå≥", "üå≤", "üéÑ", "‚ú®"];
        const lvlNames = ["–†–æ—Å—Ç–æ–∫", "–ö—É—Å—Ç", "–î–µ—Ä–µ–≤–æ", "–ë–æ–ª—å—à–æ–µ –¥–µ—Ä–µ–≤–æ", "–î—É–±", "–ó–æ–ª–æ—Ç–æ–µ –î—Ä–µ–≤–æ"];

        function update() {
            document.getElementById('coins').textContent = Math.floor(state.coins);
            document.getElementById('energyText').textContent = Math.floor(state.energy) + "/" + state.maxEnergy;
            document.getElementById('energyFill').style.width = (state.energy / state.maxEnergy * 100) + "%";
            
            // –°–º–µ–Ω–∞ —É—Ä–æ–≤–Ω—è
            let currentLvl = Math.min(Math.floor(state.coins / 500), 5);
            document.getElementById('mainTree').textContent = trees[currentLvl];
            document.getElementById('lvlName').textContent = lvlNames[currentLvl];

            document.getElementById('tapCost').textContent = 50 * state.power;
            document.getElementById('energyCost').textContent = state.maxEnergy * 2;
            
            localStorage.setItem('mTree_v1', JSON.stringify(state));
        }

        document.getElementById('treeBtn').onclick = (e) => {
            if (state.energy < 1) {
                tg.HapticFeedback.notificationOccurred('error');
                return;
            }

            state.coins += state.power;
            state.energy -= 1;

            // –ê–Ω–∏–º–∞—Ü–∏—è
            const clickAnim = document.createElement('div');
            clickAnim.className = 'tap-anim';
            clickAnim.textContent = "+" + state.power;
            clickAnim.style.left = e.clientX + "px";
            clickAnim.style.top = e.clientY + "px";
            document.body.appendChild(clickAnim);
            setTimeout(() => clickAnim.remove(), 800);

            document.getElementById('treeBtn').style.transform = "scale(0.9)";
            setTimeout(() => document.getElementById('treeBtn').style.transform = "scale(1)", 100);

            tg.HapticFeedback.impactOccurred('medium');
            update();
        };

        function buy(type) {
            if (type === 'tap') {
                let cost = 50 * state.power;
                if (state.coins >= cost) {
                    state.coins -= cost;
                    state.power++;
                }
            } else if (type === 'energy') {
                let cost = state.maxEnergy * 2;
                if (state.coins >= cost) {
                    state.coins -= cost;
                    state.maxEnergy += 50;
                    state.energy = state.maxEnergy;
                }
            }
            tg.HapticFeedback.notificationOccurred('success');
            update();
        }

        setInterval(() => {
            if (state.energy < state.maxEnergy) {
                state.energy = Math.min(state.maxEnergy, state.energy + 0.4);
                update();
            }
        }, 500);

        update();
    </script>
</body>
</html>
