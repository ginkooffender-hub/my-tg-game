<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MONEY TREE üéÆ 90's EDITION</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0f1e, #1a1f3a);
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
            position: relative;
        }
        
        /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Ñ–æ–Ω —Å –ø–æ–º–µ—Ö–∞–º–∏ */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(0deg, 
                    rgba(0,0,0,0.15) 0px, 
                    rgba(0,0,0,0.15) 2px,
                    transparent 2px,
                    transparent 4px);
            pointer-events: none;
            z-index: 1000;
            animation: scanlines 8s linear infinite;
        }
        
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }
        
        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .cartridge {
            width: 100%;
            max-width: 420px;
            background: #1e2a3a;
            border: 6px solid #ff6b6b;
            border-radius: 30px 30px 15px 15px;
            padding: 20px 12px;
            position: relative;
            box-shadow: 
                0 15px 0 #b22222,
                0 20px 20px rgba(0,0,0,0.5);
            max-height: 700px;
            overflow-y: auto;
            scrollbar-width: none;
        }
        
        .cartridge::-webkit-scrollbar {
            display: none;
        }
        
        /* –ù–∞–∫–ª–µ–π–∫–∞ */
        .cartridge-label {
            position: sticky;
            top: 0;
            background: #ffd700;
            color: #000;
            font-size: 12px;
            padding: 8px 20px;
            border-radius: 20px;
            border: 3px solid #b8860b;
            text-align: center;
            margin-bottom: 10px;
            z-index: 100;
            box-shadow: 0 4px 0 #8b6910;
        }
        
        /* –≠–∫—Ä–∞–Ω */
        .screen {
            background: #0a1420;
            border: 6px solid #4a4a6a;
            border-radius: 20px;
            padding: 15px;
            margin: 15px 0 20px 0;
            box-shadow: inset 0 0 30px rgba(0,255,0,0.2);
        }
        
        /* LED –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
        .led-panel {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 5px;
            background: #000;
            border: 2px solid #3a3a5a;
        }
        
        .led {
            color: #ff4d4d;
            font-size: 10px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* –°—á–µ—Ç—á–∏–∫ –º–æ–Ω–µ—Ç */
        .score-panel {
            background: #000;
            border: 4px solid #ffd700;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .coin-sprite {
            font-size: 28px;
            filter: drop-shadow(0 0 10px #ffd700);
            animation: spin 2s steps(8) infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .score-value {
            color: #ffd700;
            font-size: 24px;
            text-shadow: 4px 4px 0 #8b6910;
            letter-spacing: 2px;
        }
        
        /* –î–µ—Ä–µ–≤–æ */
        .tree-area {
            background: #2a5a3a;
            border: 6px solid #1e3a2a;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            cursor: pointer;
            position: relative;
            box-shadow: 
                0 10px 0 #1e3a2a,
                inset 0 -5px 0 #3a7a4a;
            transition: all 0.03s linear;
        }
        
        .tree-area:active {
            transform: translateY(10px);
            box-shadow: 0 0 0 #1e3a2a;
        }
        
        .tree-sprite {
            font-size: 120px;
            display: block;
            filter: drop-shadow(0 10px 0 #1e3a2a);
            animation: treeSway 2s infinite;
        }
        
        @keyframes treeSway {
            0%, 100% { transform: rotate(0deg); }
            33% { transform: rotate(2deg); }
            66% { transform: rotate(-2deg); }
        }
        
        /* –≠–Ω–µ—Ä–≥–∏—è */
        .energy-container {
            margin: 20px 0;
            background: #1a1a3a;
            border: 4px solid #4a4a8a;
            padding: 15px;
        }
        
        .energy-header {
            display: flex;
            justify-content: space-between;
            color: #7fffd4;
            font-size: 12px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #2a6a6a;
        }
        
        .energy-track {
            background: #2a2a5a;
            height: 25px;
            border: 3px solid #6a6aaa;
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #7fffd4, #40e0d0);
            width: 100%;
            box-shadow: inset 0 2px 0 #b0ffff;
            transition: width 0.1s steps(5);
        }
        
        /* –°–∏–ª–∞ —Ç–∞–ø–∞ */
        .power-indicator {
            color: #ffb347;
            font-size: 10px;
            text-align: center;
            margin: 10px 0;
            text-shadow: 2px 2px 0 #b85e00;
        }
        
        /* –ú–µ–Ω—é */
        .menu-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin: 20px 0;
        }
        
        .menu-btn {
            background: #ff6b6b;
            border: none;
            border-bottom: 6px solid #b22222;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            padding: 15px 0;
            cursor: pointer;
            text-align: center;
            text-shadow: 2px 2px 0 #8b0000;
            transition: all 0.03s linear;
        }
        
        .menu-btn:active {
            transform: translateY(6px);
            border-bottom-width: 2px;
        }
        
        .menu-btn.active {
            background: #ffd700;
            color: #000;
            text-shadow: 2px 2px 0 #b8860b;
            border-bottom-color: #b8860b;
        }
        
        /* –ú–ê–ì–ê–ó–ò–ù - —Ç–µ–ø–µ—Ä—å —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π! */
        .shop-container {
            background: #1e2a3a;
            border: 4px solid #ffd700;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .shop-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .shop-container::-webkit-scrollbar-track {
            background: #1e2a3a;
        }
        
        .shop-container::-webkit-scrollbar-thumb {
            background: #ffd700;
            border: 2px solid #b8860b;
        }
        
        .shop-item {
            background: #2a3a5a;
            border: 4px solid #4a6a9a;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .shop-item:last-child {
            margin-bottom: 0;
        }
        
        .item-info h3 {
            color: #ffd700;
            font-size: 12px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 0 #8b6910;
        }
        
        .item-price {
            color: #7fffd4;
            font-size: 10px;
        }
        
        .buy-btn {
            background: #ffd700;
            border: none;
            border-bottom: 4px solid #b8860b;
            color: #000;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            padding: 10px 15px;
            cursor: pointer;
        }
        
        .buy-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        
        /* –î—Ä—É–∑—å—è */
        .friends-area {
            background: #2a3a5a;
            border: 4px solid #4a6a9a;
            padding: 20px;
            margin-top: 15px;
            text-align: center;
        }
        
        .invite-btn {
            background: #7fffd4;
            border: none;
            border-bottom: 6px solid #40e0d0;
            color: #000;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            padding: 20px;
            width: 100%;
            cursor: pointer;
            margin: 15px 0;
            text-shadow: 2px 2px 0 #20b2aa;
        }
        
        .friend-counter {
            color: #ffd700;
            font-size: 10px;
            text-shadow: 2px 2px 0 #8b6910;
        }
        
        /* –ü–æ–ø–∞–ø */
        .popup-8bit {
            position: fixed;
            color: #ffd700;
            font-family: 'Press Start 2P', cursive;
            font-size: 20px;
            pointer-events: none;
            z-index: 9999;
            text-shadow: 
                4px 4px 0 #b8860b,
                -2px -2px 0 #ff8c00;
            animation: popupFloat 0.6s steps(5) forwards;
        }
        
        @keyframes popupFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-120px) scale(2); opacity: 0; }
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç —É–¥–∞—Ä–∞ */
        .hit-flash {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 215, 0, 0.5);
            animation: flash 0.1s steps(2);
            pointer-events: none;
        }
        
        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        /* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.3s steps(5);
        }
        
        .boot-box {
            background: #1a2a3a;
            border: 8px solid #ff6b6b;
            padding: 40px 30px;
            text-align: center;
            max-width: 350px;
            box-shadow: 0 20px 0 #8b0000;
        }
        
        .boot-title {
            color: #ffd700;
            font-size: 20px;
            margin-bottom: 25px;
            text-shadow: 5px 5px 0 #8b6910;
        }
        
        .boot-animation {
            font-size: 70px;
            margin: 20px 0;
            animation: bootBob 0.5s steps(2) infinite;
        }
        
        @keyframes bootBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .boot-text {
            color: #7fffd4;
            font-size: 12px;
            margin: 25px 0;
            line-height: 2;
        }
        
        .power-btn {
            background: #ff6b6b;
            border: none;
            border-bottom: 8px solid #b22222;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-size: 18px;
            padding: 20px 30px;
            width: 100%;
            cursor: pointer;
            margin-top: 20px;
            text-shadow: 3px 3px 0 #8b0000;
        }
        
        .power-btn:active {
            transform: translateY(8px);
            border-bottom-width: 4px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="bootScreen" class="boot-screen">
        <div class="boot-box">
            <div class="boot-title">üí∞ MONEY TREE üí∞</div>
            <div class="boot-animation" id="bootEmoji">üå±</div>
            <div class="boot-text" id="bootMessage">–ó–ê–ì–†–£–ó–ö–ê...</div>
            <button class="power-btn" id="startBtn">POWER</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–∞ -->
    <div class="cartridge">
        <div class="cartridge-label">üéÆ 8-BIT EDITION üéÆ</div>
        
        <div class="led-panel">
            <span class="led">üî¥ POWER</span>
            <span class="led">üü° READY</span>
            <span class="led">üü¢ PLAY</span>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="mainScreen">
            <div class="score-panel">
                <span class="coin-sprite">üí∞</span>
                <span class="score-value" id="coinDisplay">0000</span>
            </div>
            
            <div class="tree-area" id="treeClick">
                <span class="tree-sprite" id="treeEmoji">üå±</span>
                <div id="hitEffect" class="hit-flash" style="display: none;"></div>
            </div>
            
            <div class="energy-container">
                <div class="energy-header">
                    <span>üîã ENERGY</span>
                    <span id="energyDisplay">100/100</span>
                </div>
                <div class="energy-track">
                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="power-indicator">
                ‚ö° TAP POWER: <span id="tapPower">1</span>x ‚ö°
            </div>
        </div>
        
        <!-- –ú–∞–≥–∞–∑–∏–Ω (–ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–π) -->
        <div id="shopScreen" class="hidden">
            <div class="shop-container">
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üå≥ –≠–í–û–õ–Æ–¶–ò–Ø</h3>
                        <span class="item-price" id="evoPrice">2000</span>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('evo')">BUY</button>
                </div>
                
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üí™ –°–ò–õ–ê –¢–ê–ü–ê</h3>
                        <span class="item-price" id="tapPrice">100</span>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('tap')">BUY</button>
                </div>
                
                <div class="shop-item">
                    <div class="item-info">
                        <h3>üîã MAX –≠–ù–ï–†–ì–ò–Ø</h3>
                        <span class="item-price" id="energyPrice">50</span>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('energy')">BUY</button>
                </div>
                
                <div class="shop-item">
                    <div class="item-info">
                        <h3>ü§ñ –ê–í–¢–û-–§–ê–†–ú</h3>
                        <span class="item-price" id="passivePrice">500</span>
                    </div>
                    <button class="buy-btn" onclick="buyUpgrade('passive')">BUY</button>
                </div>
            </div>
        </div>
        
        <!-- –î—Ä—É–∑—å—è -->
        <div id="friendsScreen" class="hidden">
            <div class="friends-area">
                <button class="invite-btn" onclick="inviteFriend()">
                    üîó –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê
                </button>
                <div class="friend-counter" id="friendCount">
                    –î–†–£–ó–ï–ô: 0
                </div>
                <div style="color: #7fffd4; font-size: 8px; margin-top: 15px;">
                    +500 –ó–ê –ö–ê–ñ–î–û–ì–û –î–†–£–ì–ê
                </div>
            </div>
        </div>
        
        <!-- –ú–µ–Ω—é -->
        <div class="menu-buttons">
            <button class="menu-btn active" onclick="showScreen('main', this)">üå≥ –ò–ì–†–ê</button>
            <button class="menu-btn" onclick="showScreen('shop', this)">üè™ –ú–ê–ì–ê–ó–ò–ù</button>
            <button class="menu-btn" onclick="showScreen('friends', this)">üë• –î–†–£–ó–¨–Ø</button>
        </div>
    </div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userId = tg.initDataUnsafe?.user?.id || 'guest_' + Math.random();
        const userName = tg.initDataUnsafe?.user?.first_name || '–ò–ì–†–û–ö';
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const SAVE_KEY = 'money_tree_90s_' + userId;
        const WELCOME_KEY = 'welcome_90s_' + userId;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            coins: 0,
            tapPower: 1,
            energy: 100,
            maxEnergy: 100,
            passiveIncome: 0,
            treeLevel: 0,
            referrals: []
        };
        
        // –°—Ç–∞–¥–∏–∏ –¥–µ—Ä–µ–≤–∞
        const treeStages = ['üå±', 'üåø', 'üå≥', 'üå≤', 'üéÑ', 'üëëüå≥'];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞
        try {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                gameState = {...gameState, ...JSON.parse(saved)};
            }
        } catch (e) {}
        
        // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        const bootScreen = document.getElementById('bootScreen');
        const bootMessage = document.getElementById('bootMessage');
        const bootEmoji = document.getElementById('bootEmoji');
        
        const welcomeShown = localStorage.getItem(WELCOME_KEY);
        
        if (welcomeShown) {
            bootScreen.style.display = 'none';
        } else {
            bootMessage.innerHTML = `–ü–†–ò–í–ï–¢,<br>${userName}!<br>+500 –ë–û–ù–£–°`;
            bootEmoji.textContent = 'üí∞';
        }
        
        // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!welcomeShown) {
                gameState.coins += 500;
                localStorage.setItem(WELCOME_KEY, 'true');
                playSound('coin');
            }
            
            bootScreen.style.opacity = '0';
            setTimeout(() => {
                bootScreen.style.display = 'none';
            }, 300);
            
            updateDisplay();
        });
        
        // –†–µ—Ñ–µ—Ä–∞–ª–∫–∞
        const urlParams = new URLSearchParams(window.location.search);
        const refId = urlParams.get('startapp');
        
        if (refId && refId !== userId && !localStorage.getItem('ref_' + userId)) {
            gameState.coins += 500;
            gameState.referrals.push(refId);
            localStorage.setItem('ref_' + userId, 'true');
            playSound('coin');
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –∑–≤—É–∫–æ–≤
        function playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const ctx = new AudioContext();
            
            if (type === 'coin') {
                // –ó–≤—É–∫ –º–æ–Ω–µ—Ç—ã (–∫–∞–∫ –≤ Super Mario)
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'square';
                osc.frequency.setValueAtTime(660, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.1);
                
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start();
                osc.stop(ctx.currentTime + 0.2);
            }
            
            if (type === 'click') {
                // –ó–≤—É–∫ –∫–ª–∏–∫–∞ (–∫–∞–∫ –≤ Zelda)
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(220, ctx.currentTime);
                
                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            }
            
            if (type === 'buy') {
                // –ó–≤—É–∫ –ø–æ–∫—É–ø–∫–∏
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(330, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.1);
                osc.frequency.exponentialRampToValueAtTime(554, ctx.currentTime + 0.2);
                
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            }
            
            if (type === 'error') {
                // –ó–≤—É–∫ –æ—à–∏–±–∫–∏
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(110, ctx.currentTime);
                
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start();
                osc.stop(ctx.currentTime + 0.15);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
        function updateDisplay() {
            const coinsStr = Math.floor(gameState.coins).toString().padStart(4, '0').slice(-4);
            document.getElementById('coinDisplay').textContent = coinsStr;
            
            document.getElementById('energyDisplay').textContent = 
                Math.floor(gameState.energy) + '/' + gameState.maxEnergy;
            
            const percent = (gameState.energy / gameState.maxEnergy) * 100;
            document.getElementById('energyFill').style.width = percent + '%';
            
            document.getElementById('treeEmoji').textContent = treeStages[gameState.treeLevel];
            document.getElementById('tapPower').textContent = gameState.tapPower;
            
            document.getElementById('evoPrice').textContent = (gameState.treeLevel + 1) * 2000;
            document.getElementById('tapPrice').textContent = 
                Math.floor(100 * Math.pow(1.5, gameState.tapPower - 1));
            document.getElementById('energyPrice').textContent = gameState.maxEnergy;
            document.getElementById('passivePrice').textContent = (gameState.passiveIncome + 1) * 500;
            
            document.getElementById('friendCount').textContent = '–î–†–£–ó–ï–ô: ' + gameState.referrals.length;
            
            localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        }
        
        // –ö–ª–∏–∫ –ø–æ –¥–µ—Ä–µ–≤—É
        document.getElementById('treeClick').addEventListener('click', function(e) {
            if (gameState.energy < 1) {
                playSound('error');
                tg.HapticFeedback.notificationOccurred('warning');
                return;
            }
            
            // –ó–≤—É–∫ –∫–ª–∏–∫–∞
            playSound('click');
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            const hit = document.getElementById('hitEffect');
            hit.style.display = 'block';
            setTimeout(() => hit.style.display = 'none', 100);
            
            // –ó–∞—Ä–∞–±–æ—Ç–æ–∫
            const earn = gameState.tapPower * (1 + gameState.treeLevel * 0.5);
            gameState.coins += earn;
            gameState.energy -= 1;
            
            // –í–∏–±—Ä–∞—Ü–∏—è
            tg.HapticFeedback.impactOccurred('medium');
            
            // –ü–æ–ø–∞–ø
            const popup = document.createElement('div');
            popup.className = 'popup-8bit';
            popup.textContent = '+' + Math.floor(earn);
            
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            
            if (clientX && clientY) {
                popup.style.left = clientX + 'px';
                popup.style.top = clientY + 'px';
                document.body.appendChild(popup);
                setTimeout(() => popup.remove(), 600);
            }
            
            updateDisplay();
        });
        
        // –ü–æ–∫—É–ø–∫–∏
        window.buyUpgrade = function(type) {
            let cost = 0;
            
            switch(type) {
                case 'evo':
                    if (gameState.treeLevel >= 5) return;
                    cost = (gameState.treeLevel + 1) * 2000;
                    break;
                case 'tap':
                    cost = Math.floor(100 * Math.pow(1.5, gameState.tapPower - 1));
                    break;
                case 'energy':
                    cost = gameState.maxEnergy;
                    break;
                case 'passive':
                    cost = (gameState.passiveIncome + 1) * 500;
                    break;
            }
            
            if (gameState.coins >= cost) {
                gameState.coins -= cost;
                
                switch(type) {
                    case 'evo': gameState.treeLevel++; break;
                    case 'tap': gameState.tapPower++; break;
                    case 'energy': 
                        gameState.maxEnergy += 50; 
                        gameState.energy = gameState.maxEnergy;
                        break;
                    case 'passive': gameState.passiveIncome += 0.5; break;
                }
                
                playSound('buy');
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                playSound('error');
                tg.HapticFeedback.notificationOccurred('error');
            }
            
            updateDisplay();
        };
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        window.showScreen = function(screen, btn) {
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('shopScreen').classList.add('hidden');
            document.getElementById('friendsScreen').classList.add('hidden');
            
            document.getElementById(screen + 'Screen').classList.remove('hidden');
        };
        
        // –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞
        window.inviteFriend = function() {
            const botName = 'YOUR_BOT_NAME'; // –ó–ê–ú–ï–ù–ò –ù–ê –ò–ú–Ø –°–í–û–ï–ì–û –ë–û–¢–ê
            const link = `https://t.me/${botName}/app?startapp=${userId}`;
            
            tg.openTelegramLink(
                'https://t.me/share/url?url=' + encodeURIComponent(link) + 
                '&text=üå≥ –ü–†–ò–°–û–ï–î–ò–ù–Ø–ô–°–Ø –ö MONEY TREE! –°–¢–ê–†–¢–û–í–´–ô –ë–û–ù–£–° 500 –ú–û–ù–ï–¢!'
            );
            
            playSound('click');
        };
        
        // –ê–≤—Ç–æ-—Ñ–∞—Ä–º –∏ —Ä–µ–≥–µ–Ω
        setInterval(() => {
            if (gameState.passiveIncome > 0) {
                gameState.coins += (gameState.passiveIncome * (1 + gameState.treeLevel * 0.5)) / 10;
            }
            
            if (gameState.energy < gameState.maxEnergy) {
                gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + 0.3);
            }
            
            updateDisplay();
        }, 100);
        
        // –°—Ç–∞—Ä—Ç
        showScreen('main', document.querySelector('.menu-btn'));
        updateDisplay();
    </script>
</body>
</html>
