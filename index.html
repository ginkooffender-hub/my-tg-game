<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Money Tree</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:system-ui,Arial;
background:radial-gradient(circle at top,#1f3b73,#020617);
color:#fff;
overflow-x:hidden;
}
.app{max-width:420px;margin:auto;padding:18px}
.card{
background:linear-gradient(180deg,rgba(30,41,59,.9),rgba(2,6,23,.9));
border-radius:28px;
padding:22px;
box-shadow:0 25px 80px rgba(0,0,0,.6);
text-align:center;
}

.title{font-size:26px;margin-bottom:10px;font-weight:700;letter-spacing:.5px}

.treeWrap{
position:relative;
height:170px;
display:flex;
align-items:center;
justify-content:center;
}

.tree{
font-size:110px;
cursor:pointer;
user-select:none;
transition:transform .08s, filter .15s;
filter:drop-shadow(0 10px 20px rgba(0,0,0,.6));
}

.tree:active{
transform:scale(.88) rotate(-4deg);
filter:brightness(1.2);
}

.coin{
position:absolute;
font-size:24px;
animation:coinFall 900ms ease-in forwards;
pointer-events:none;
}

@keyframes coinFall{
0%{transform:translateY(-10px) scale(.7);opacity:0}
20%{opacity:1}
100%{transform:translateY(120px) rotate(120deg);opacity:0}
}

.stats{
display:flex;
justify-content:space-between;
margin-top:6px;
font-size:18px
}

.bar{
height:12px;
background:#1f2937;
border-radius:10px;
margin-top:8px;
overflow:hidden
}

.energy{
height:100%;
background:linear-gradient(90deg,#22c55e,#4ade80);
width:100%;
transition:width .25s
}

.section{margin-top:18px}

.shop{
display:grid;
grid-template-columns:1fr 1fr;
gap:10px;
margin-top:10px
}

.btn{
background:linear-gradient(180deg,#1f2937,#111827);
border:none;
border-radius:16px;
padding:12px;
color:white;
font-size:13px;
cursor:pointer;
transition:.15s;
box-shadow:0 6px 14px rgba(0,0,0,.5)
}

.btn:active{transform:scale(.95)}
.btn:hover{background:#374151}

.small{font-size:12px;opacity:.7}

.floating{
position:absolute;
font-weight:700;
color:#fde047;
animation:floatUp 900ms ease-out forwards;
pointer-events:none
}

@keyframes floatUp{
0%{transform:translateY(0);opacity:1}
100%{transform:translateY(-40px);opacity:0}
}

</style>
</head>
<body>
<div class="app">
<div class="card">

<div class="title">ðŸŒ³ Money Tree</div>

<div class="treeWrap" id="treeWrap">
<div id="tree" class="tree">ðŸŒ³</div>
</div>

<div class="stats">
<div>ðŸª™ <span id="coins">0</span></div>
<div>âš¡ <span id="energyText">0</span></div>
</div>

<div class="bar"><div id="energy" class="energy"></div></div>

<div class="section">
<div class="small">Upgrades</div>
<div class="shop">
<button class="btn" id="tapUpgrade"></button>
<button class="btn" id="energyUpgrade"></button>
<button class="btn" id="regenUpgrade"></button>
<button class="btn" id="autoUpgrade"></button>
</div>
</div>

</div>
</div>

<script>
const tg = window.Telegram?.WebApp
if(tg) tg.expand()

let state = JSON.parse(localStorage.getItem("moneyTreeSave")||"null") || {
coins:0,
power:1,
energy:100,
maxEnergy:100,
regen:1,
auto:0,
tapLevel:1,
energyLevel:1,
regenLevel:1,
autoLevel:0
}

function save(){localStorage.setItem("moneyTreeSave",JSON.stringify(state))}

const tree = document.getElementById("tree")
const wrap = document.getElementById("treeWrap")
const coinsEl = document.getElementById("coins")
const energyEl = document.getElementById("energy")
const energyText = document.getElementById("energyText")

const tapBtn = document.getElementById("tapUpgrade")
const energyBtn = document.getElementById("energyUpgrade")
const regenBtn = document.getElementById("regenUpgrade")
const autoBtn = document.getElementById("autoUpgrade")

function prices(){
return {
tap: 50 * state.tapLevel,
energy: 120 * state.energyLevel,
regen: 140 * state.regenLevel,
auto: 300 * (state.autoLevel+1)
}
}

function updateButtons(){
const p = prices()
tapBtn.innerText = `ðŸ’ª Tap +1 (${p.tap})`
energyBtn.innerText = `ðŸ”‹ Energy +20 (${p.energy})`
regenBtn.innerText = `âš¡ Regen +1 (${p.regen})`
autoBtn.innerText = `ðŸ¤– Auto tap (${p.auto})`
}

function update(){
coinsEl.textContent = Math.floor(state.coins)
energyText.textContent = Math.floor(state.energy)
energyEl.style.width = (state.energy/state.maxEnergy*100)+"%"
updateButtons()
save()
}

function coinBurst(x,y,amount){
for(let i=0;i<Math.min(amount,6);i++){
const c=document.createElement("div")
c.className="coin"
c.innerText="ðŸª™"
c.style.left=(x+(Math.random()*60-30))+'px'
c.style.top=(y-20)+'px'
wrap.appendChild(c)
setTimeout(()=>c.remove(),900)
}
}

function floatingText(x,y,value){
const el=document.createElement("div")
el.className="floating"
el.innerText=`+${value}`
el.style.left=x+'px'
el.style.top=y+'px'
wrap.appendChild(el)
setTimeout(()=>el.remove(),900)
}

function clickTree(e){
if(state.energy<=0) return
state.coins += state.power
state.energy -= 2

const rect = wrap.getBoundingClientRect()
const x = e.clientX - rect.left
const y = e.clientY - rect.top

coinBurst(x,y,state.power)
floatingText(x,y,state.power)

if(tg?.HapticFeedback) tg.HapticFeedback.impactOccurred("light")

update()
}

tree.addEventListener("click",clickTree)

setInterval(()=>{
state.energy += state.regen * 0.5
if(state.energy>state.maxEnergy) state.energy=state.maxEnergy
update()
},500)

setInterval(()=>{
if(state.auto>0){
state.coins += state.auto
update()
}
},1000)

// upgrades

tapBtn.onclick=()=>{
const p = prices().tap
if(state.coins>=p){
state.coins-=p
state.tapLevel++
state.power++
update()
}
}

energyBtn.onclick=()=>{
const p = prices().energy
if(state.coins>=p){
state.coins-=p
state.energyLevel++
state.maxEnergy += 20
state.energy = state.maxEnergy
update()
}
}

regenBtn.onclick=()=>{
const p = prices().regen
if(state.coins>=p){
state.coins-=p
state.regenLevel++
state.regen += 0.5
update()
}
}

autoBtn.onclick=()=>{
const p = prices().auto
if(state.coins>=p){
state.coins-=p
state.autoLevel++
state.auto += 1
update()
}
}

// offline progress
let last = Number(localStorage.getItem("lastTime")||Date.now())
let now = Date.now()
let diff = Math.floor((now-last)/1000)
if(diff>0 && state.auto>0){
state.coins += diff * state.auto
}
localStorage.setItem("lastTime",now)

update()
</script>
</body>
</html>
