<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Money Tree: Evolution v4.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #ffcf4d; 
            --emerald: #2ecc71; 
            --glass: rgba(255, 255, 255, 0.08); 
            --blue: #3498db;
            --purple: #9b59b6;
        }
        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Montserrat', sans-serif; 
            background: radial-gradient(circle at top, #1e293b, #020617); 
            color: white; 
            height: 100vh; 
            overflow: hidden; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent; 
        }
        .app { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            padding: 20px 20px 100px 20px; 
            box-sizing: border-box; 
            position: relative;
        }
        .balance-card { 
            background: var(--glass); 
            backdrop-filter: blur(15px); 
            padding: 20px; 
            border-radius: 28px; 
            border: 1px solid rgba(255,255,255,0.1); 
            text-align: center; 
            margin-bottom: 20px; 
            position: relative;
            overflow: hidden;
        }
        .balance-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.03), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            20%, 100% { transform: translateX(100%) rotate(45deg); }
        }
        .balance-val { 
            font-family: 'Bungee'; 
            font-size: 48px; 
            color: var(--gold); 
            text-shadow: 0 4px 0 #b8860b; 
            line-height: 1; 
            transition: transform 0.2s;
        }
        .balance-val:active {
            transform: scale(1.1);
        }
        .passive-income { 
            font-size: 13px; 
            color: var(--emerald); 
            font-weight: 800; 
            margin-bottom: 5px; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .tab-content { 
            display: none; 
            flex: 1; 
            flex-direction: column; 
            align-items: center; 
            width: 100%; 
            overflow-y: auto; 
            scrollbar-width: none;
        }
        .tab-content::-webkit-scrollbar {
            display: none;
        }
        .tab-content.active { 
            display: flex; 
        }
        .tree-container { 
            flex: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
            width: 100%; 
        }
        .tree-emoji { 
            font-size: 160px; 
            cursor: pointer; 
            transition: all 0.1s; 
            filter: drop-shadow(0 0 30px rgba(46, 204, 113, 0.5));
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .tree-emoji:active { 
            transform: scale(0.85) rotate(5deg); 
        }
        .list-container { 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            margin-top: 10px;
        }
        .list-item { 
            background: var(--glass); 
            padding: 16px; 
            border-radius: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border: 1px solid rgba(255,255,255,0.05);
            transition: transform 0.2s;
        }
        .list-item:active {
            transform: scale(0.98);
        }
        .buy-btn, .ref-btn { 
            background: var(--gold); 
            color: #451a03; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 16px; 
            font-weight: 800; 
            cursor: pointer; 
            transition: all 0.2s;
            box-shadow: 0 4px 0 #b8860b;
        }
        .buy-btn:active, .ref-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        .energy-section { 
            width: 100%; 
            margin-top: auto; 
            padding-bottom: 10px; 
        }
        .energy-bar { 
            width: 100%; 
            height: 16px; 
            background: rgba(0,0,0,0.4); 
            border-radius: 10px; 
            overflow: hidden; 
            margin-top: 5px; 
            border: 1px solid rgba(255,255,255,0.1);
        }
        .energy-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--emerald), #27ae60); 
            transition: width 0.3s; 
            box-shadow: 0 0 20px var(--emerald); 
        }
        .nav { 
            position: fixed; 
            bottom: 20px; 
            left: 20px; 
            right: 20px; 
            background: rgba(15, 23, 42, 0.95); 
            backdrop-filter: blur(20px); 
            border-radius: 32px; 
            display: flex; 
            justify-content: space-around; 
            padding: 12px; 
            border: 1px solid rgba(255,255,255,0.1); 
            z-index: 100;
        }
        .nav-item { 
            font-size: 12px; 
            opacity: 0.4; 
            text-align: center; 
            color: white; 
            cursor: pointer; 
            flex: 1; 
            padding: 8px;
            border-radius: 16px;
            transition: all 0.2s;
        }
        .nav-item.active { 
            opacity: 1; 
            color: var(--gold); 
            background: rgba(255,207,77,0.1);
        }
        .tap-pop { 
            position: absolute; 
            color: white; 
            font-family: 'Bungee'; 
            font-size: 30px; 
            pointer-events: none; 
            animation: tapUp 0.8s ease-out forwards; 
            text-shadow: 0 2px 0 #000;
            z-index: 1000;
        }
        @keyframes tapUp { 
            0% { transform: translateY(0) scale(1); opacity: 1; } 
            100% { transform: translateY(-150px) scale(1.5); opacity: 0; } 
        }
        .premium-badge {
            background: linear-gradient(135deg, var(--gold), var(--purple));
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 800;
            color: #000;
        }
        .stars-btn {
            background: linear-gradient(135deg, #ffd700, #ffa500);
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--glass);
            border-radius: 12px;
            margin-bottom: 5px;
        }
        .top-1 {
            background: linear-gradient(135deg, var(--gold), #f1c40f);
            color: #000;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="balance-card">
            <div class="passive-income">
                <span>‚õèÔ∏è –ü–†–ò–ë–´–õ–¨: +<span id="pIncome">0</span>/–°–ï–ö</span>
                <span class="premium-badge" id="premiumBadge" style="display:none;">PREMIUM</span>
            </div>
            <div class="balance-val" id="coins">0</div>
            <div id="lvlName" style="font-size:10px; opacity:0.5; letter-spacing:2px; text-transform:uppercase;">–†–û–°–¢–û–ö</div>
        </div>

        <div id="game" class="tab-content active">
            <div class="tree-container">
                <div class="tree-emoji" id="treeBtn">üå±</div>
            </div>
            <div class="energy-section">
                <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:800;">
                    <span>üîã –≠–ù–ï–†–ì–ò–Ø</span>
                    <span id="eText">100/100</span>
                </div>
                <div class="energy-bar">
                    <div class="energy-fill" id="eFill"></div>
                </div>
                <button class="stars-btn" onclick="buyWithStars('energy_refill')" id="refillBtn">
                    ‚≠ê –í–æ—Å–ø–æ–ª–Ω–∏—Ç—å –∑–∞ 5 Stars
                </button>
            </div>
        </div>

        <div id="boosts" class="tab-content">
            <h3 style="font-family:'Bungee'; color:var(--gold); margin:0 0 10px 0;">üöÄ –ú–ê–ì–ê–ó–ò–ù</h3>
            <div class="list-container">
                <div class="list-item">
                    <div>
                        <b>üåü –≠–≤–æ–ª—é—Ü–∏—è</b><br>
                        <small id="evoCostText">–£—Ä. 1</small>
                    </div>
                    <button class="buy-btn" onclick="buy('evo')">–ê–ü</button>
                </div>
                <div class="list-item">
                    <div>
                        <b>üí™ –ú—É–ª—å—Ç–∏-—Ç–∞–ø</b><br>
                        <small id="tapCostText">–¶–µ–Ω–∞: 100</small>
                    </div>
                    <button class="buy-btn" onclick="buy('tap')">–ê–ü</button>
                </div>
                <div class="list-item">
                    <div>
                        <b>üîã –ú–∞–∫—Å. –≠–Ω–µ—Ä–≥–∏—è</b><br>
                        <small id="energyCostText">–¶–µ–Ω–∞: 50</small>
                    </div>
                    <button class="buy-btn" onclick="buy('energy')">–ê–ü</button>
                </div>
                <div class="list-item">
                    <div>
                        <b>ü§ñ –°–∞–¥–æ–≤–Ω–∏–∫</b><br>
                        <small id="autoCostText">–¶–µ–Ω–∞: 500</small>
                    </div>
                    <button class="buy-btn" onclick="buy('auto')">–ê–ü</button>
                </div>
            </div>
            
            <h3 style="font-family:'Bungee'; color:var(--purple); margin:20px 0 10px 0;">‚≠ê –ü–†–ï–ú–ò–£–ú</h3>
            <div class="list-container">
                <div class="list-item">
                    <div>
                        <b>üöÄ –£–ª—å—Ç—Ä–∞-–±—É—Å—Ç</b><br>
                        <small>+5 –∫ —Å–∏–ª–µ —Ç–∞–ø–∞</small>
                    </div>
                    <button class="buy-btn" style="background:var(--purple); color:white;" onclick="buyWithStars('premium_boost')">10 ‚≠ê</button>
                </div>
                <div class="list-item">
                    <div>
                        <b>‚ö° –î–≤–æ–π–Ω–æ–π –¥–æ—Ö–æ–¥</b><br>
                        <small>—Ö2 –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥</small>
                    </div>
                    <button class="buy-btn" style="background:var(--purple); color:white;" onclick="buyWithStars('double_passive')">25 ‚≠ê</button>
                </div>
            </div>
        </div>

        <div id="friends" class="tab-content">
            <h3 style="font-family:'Bungee'; color:var(--blue); margin:0 0 20px 0;">üë• –î–†–£–ó–¨–Ø</h3>
            
            <div class="list-container">
                <div class="list-item">
                    <div>
                        <b>–¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</b><br>
                        <small id="refLink">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</small>
                    </div>
                    <button class="ref-btn" style="background:var(--blue); color:white;" onclick="copyRefLink()">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
                
                <div class="list-item">
                    <div>
                        <b>–ü—Ä–∏–≥–ª–∞—Å–∏–ª –¥—Ä—É–∑–µ–π:</b><br>
                        <small id="refCount">0</small>
                    </div>
                    <button class="ref-btn" style="background:var(--blue); color:white;" onclick="shareRefLink()">
                        üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                    </button>
                </div>
            </div>
            
            <h3 style="font-family:'Bungee'; color:var(--gold); margin:20px 0 10px 0;">üèÜ –õ–ò–î–ï–†–´</h3>
            <div id="leaderboard-list" class="list-container">
                <!-- –ó–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="showTab('game', this)">üå≥<br>–ò–≥—Ä–∞</div>
            <div class="nav-item" onclick="showTab('boosts', this)">üöÄ<br>–ë—É—Å—Ç—ã</div>
            <div class="nav-item" onclick="showTab('friends', this)">üë•<br>–î—Ä—É–∑—å—è</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation(); // –°–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏

        // --- –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ---
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 'guest_' + Math.random();
        const SAVE_KEY = `mTree_v4_id_${userId}`;
        
        // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
        const urlParams = new URLSearchParams(window.location.search);
        const refId = urlParams.get('startapp') || urlParams.get('ref');

        let state = JSON.parse(localStorage.getItem(SAVE_KEY)) || {
            coins: 500, // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–æ–Ω—É—Å
            power: 1, 
            energy: 100, 
            maxEnergy: 100, 
            passive: 0, 
            treeLvl: 0, 
            lastTime: Date.now(),
            referrals: [],
            premium: false
        };

        const emojiStages = ["üå±", "üåø", "üå≥", "üå≤", "üéÑ", "‚ú®üå≥"];
        const names = ["–†–æ—Å—Ç–æ–∫", "–ö—É—Å—Ç–∏–∫", "–î–µ—Ä–µ–≤–æ", "–ë–æ–ª—å—à–æ–µ –¥–µ—Ä–µ–≤–æ", "–õ–µ—Å", "–ó–æ–ª–æ—Ç–æ–µ –î—Ä–µ–≤–æ"];

        // --- –û–ë–†–ê–ë–û–¢–ö–ê –†–ï–§–ï–†–ê–õ–ö–ò ---
        if (refId && refId !== userId && !localStorage.getItem(`referred_${userId}`)) {
            state.coins += 500;
            state.referrals.push(refId);
            localStorage.setItem(`referred_${userId}`, 'true');
            tg.showPopup({ 
                title: "üéÅ –ë–æ–Ω—É—Å!", 
                message: "–¢—ã –ø–æ–ª—É—á–∏–ª 500 –º–æ–Ω–µ—Ç –∑–∞ –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ –¥—Ä—É–≥–∞!" 
            });
        }

        // --- –§–£–ù–ö–¶–ò–ò ---
        function checkOffline() {
            const now = Date.now();
            const diffSeconds = (now - state.lastTime) / 1000;
            
            if (diffSeconds > 5) { // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 5 —Å–µ–∫—É–Ω–¥
                const recovered = diffSeconds * 0.1;
                state.energy = Math.min(state.maxEnergy, state.energy + recovered);
                
                const multi = 1 + (state.treeLvl * 0.5);
                const earned = diffSeconds * (state.passive * multi);
                
                if (earned > 1) {
                    state.coins += earned;
                    tg.showPopup({ 
                        title: "üå≥ –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!", 
                        message: `–ü–æ–∫–∞ —Ç–µ–±—è –Ω–µ –±—ã–ª–æ, –¥–µ—Ä–µ–≤–æ –ø—Ä–∏–Ω–µ—Å–ª–æ:\nüí∞ ${Math.floor(earned)} –º–æ–Ω–µ—Ç`,
                        buttons: [{ type: 'ok' }]
                    });
                }
            }
            state.lastTime = now;
        }

        function update() {
            const multi = 1 + (state.treeLvl * 0.5);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            document.getElementById('coins').textContent = Math.floor(state.coins).toLocaleString();
            document.getElementById('pIncome').textContent = (state.passive * multi).toFixed(1);
            document.getElementById('eText').textContent = Math.floor(state.energy) + "/" + state.maxEnergy;
            document.getElementById('eFill').style.width = (state.energy / state.maxEnergy * 100) + "%";
            
            // –¶–µ–Ω—ã –∞–ø–≥—Ä–µ–π–¥–æ–≤
            document.getElementById('evoCostText').innerHTML = state.treeLvl < 5 ? 
                `–£—Ä. ${state.treeLvl+1} (üí∞ ${(state.treeLvl+1)*2000})<br><small>–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x${(multi+0.5).toFixed(1)}</small>` : 
                "‚ö° –ú–ê–ö–°. –£–†–û–í–ï–ù–¨";
            
            document.getElementById('tapCostText').textContent = "üí∞ " + Math.floor(100 * Math.pow(1.8, state.power - 1));
            document.getElementById('energyCostText').textContent = "üí∞ " + Math.floor(50 * (state.maxEnergy / 50));
            document.getElementById('autoCostText').textContent = "üí∞ " + Math.floor((state.passive + 1) * 500);
            
            // –≠–º–æ–¥–∑–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ
            document.getElementById('treeBtn').textContent = emojiStages[state.treeLvl];
            document.getElementById('lvlName').textContent = names[state.treeLvl];
            
            // –ü—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å
            if (state.premium) {
                document.getElementById('premiumBadge').style.display = 'inline-block';
            }
            
            // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
            document.getElementById('refLink').textContent = getReferralLink().substring(0, 30) + '...';
            document.getElementById('refCount').textContent = state.referrals.length;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            state.lastTime = Date.now();
            localStorage.setItem(SAVE_KEY, JSON.stringify(state));
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
            syncWithServer();
        }

        // --- –¢–ê–ü –ü–û –î–ï–†–ï–í–£ ---
        document.getElementById('treeBtn').onclick = (e) => {
            if (state.energy < 1) { 
                tg.HapticFeedback.notificationOccurred('warning'); 
                return; 
            }
            
            const gain = state.power * (1 + (state.treeLvl * 0.5));
            state.coins += gain;
            state.energy -= 1;
            
            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Ç–∞–ø–∞
            const x = e.clientX || (e.touches && e.touches[0].clientX);
            const y = e.clientY || (e.touches && e.touches[0].clientY);
            
            if (x && y) {
                const p = document.createElement('div');
                p.className = 'tap-pop';
                p.textContent = `+${Math.floor(gain)}`;
                p.style.left = x + 'px'; 
                p.style.top = y + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            }
            
            tg.HapticFeedback.impactOccurred('medium');
            update();
        };

        // --- –ü–û–ö–£–ü–ö–ò –ó–ê –ú–û–ù–ï–¢–´ ---
        function buy(type) {
            let cost = 0;
            
            if (type === 'evo' && state.treeLvl < 5) cost = (state.treeLvl + 1) * 2000;
            else if (type === 'tap') cost = Math.floor(100 * Math.pow(1.8, state.power - 1));
            else if (type === 'energy') cost = Math.floor(50 * (state.maxEnergy / 50));
            else if (type === 'auto') cost = Math.floor((state.passive + 1) * 500);
            
            if (state.coins >= cost) {
                if (type === 'evo' && state.treeLvl < 5) { 
                    state.coins -= cost; 
                    state.treeLvl++; 
                }
                else if (type === 'tap') { 
                    state.coins -= cost; 
                    state.power++; 
                }
                else if (type === 'energy') { 
                    state.coins -= cost; 
                    state.maxEnergy += 50; 
                    state.energy = state.maxEnergy; 
                }
                else if (type === 'auto') { 
                    state.coins -= cost; 
                    state.passive += 0.5; 
                }
                
                tg.HapticFeedback.notificationOccurred('success');
                update();
            } else {
                tg.HapticFeedback.notificationOccurred('error');
                tg.showPopup({ 
                    title: "‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç!", 
                    message: `–ù—É–∂–Ω–æ –µ—â–µ ${Math.floor(cost - state.coins)} –º–æ–Ω–µ—Ç`,
                    buttons: [{ type: 'ok' }]
                });
            }
        }

        // --- –ü–û–ö–£–ü–ö–ò –ó–ê STARS ---
        async function buyWithStars(productId) {
            const products = {
                'premium_boost': { stars: 10, name: '–£–ª—å—Ç—Ä–∞-–±—É—Å—Ç' },
                'energy_refill': { stars: 5, name: '–í–æ—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏' },
                'double_passive': { stars: 25, name: '–î–≤–æ–π–Ω–æ–π –¥–æ—Ö–æ–¥' }
            };
            
            const product = products[productId];
            if (!product) return;
            
            try {
                tg.openInvoice({
                    currency: 'XTR',
                    prices: [{ label: product.name, amount: product.stars }],
                    payload: JSON.stringify({ userId, productId, timestamp: Date.now() })
                }, async (status) => {
                    if (status === 'paid') {
                        if (productId === 'premium_boost') {
                            state.power += 5;
                            state.premium = true;
                        } else if (productId === 'energy_refill') {
                            state.energy = state.maxEnergy;
                        } else if (productId === 'double_passive') {
                            state.passive *= 2;
                        }
                        
                        tg.HapticFeedback.notificationOccurred('success');
                        update();
                        
                        tg.showPopup({ 
                            title: "‚úÖ –£—Å–ø–µ—à–Ω–æ!", 
                            message: `–¢—ã –∫—É–ø–∏–ª ${product.name}!`,
                            buttons: [{ type: 'ok' }]
                        });
                    }
                });
            } catch (e) {
                console.error('Payment error:', e);
            }
        }

        // --- –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê ---
        function getReferralLink() {
            const botUsername = 'YOUR_BOT_USERNAME'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π
            return `https://t.me/${botUsername}/app?startapp=${userId}`;
        }

        function copyRefLink() {
            const link = getReferralLink();
            navigator.clipboard.writeText(link);
            tg.HapticFeedback.impactOccurred('light');
            tg.showPopup({ 
                title: "‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!", 
                message: "–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞",
                buttons: [{ type: 'ok' }]
            });
        }

        function shareRefLink() {
            const link = getReferralLink();
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=üå≥ –ò–≥—Ä–∞–π –≤ Money Tree –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã!`);
        }

        // --- –õ–ò–î–ï–†–ë–û–†–î (—Ç–µ—Å—Ç–æ–≤—ã–π) ---
        function loadLeaderboard() {
            const mockLeaders = [
                { name: "–ö—Ä–∏–ø—Ç–æ-–ö–æ—Ä–æ–ª—å", coins: 150000 },
                { name: "–ú–∞—É–≥–ª–∏", coins: 98000 },
                { name: "–°–∞–¥–æ–≤–Ω–∏–∫", coins: 75000 },
                { name: "–•–∞–∫–µ—Ä", coins: 50000 },
                { name: "–ù–æ–≤–∏—á–æ–∫", coins: 25000 }
            ];
            
            const html = mockLeaders.map((user, index) => `
                <div class="leaderboard-item ${index === 0 ? 'top-1' : ''}">
                    <span style="font-weight:800; min-width:30px;">${index+1}</span>
                    <span style="flex:1;">${user.name}</span>
                    <span style="font-family:'Bungee';">üí∞ ${user.coins.toLocaleString()}</span>
                </div>
            `).join('');
            
            document.getElementById('leaderboard-list').innerHTML = html;
        }

        // --- –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –° –°–ï–†–í–ï–†–û–ú ---
        async function syncWithServer() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π API
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∞
        }

        // --- –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ---
        function showTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            
            if (id === 'friends') loadLeaderboard();
        }

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        checkOffline();
        loadLeaderboard();
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 100–º—Å
        setInterval(() => {
            if (state.energy < state.maxEnergy) {
                state.energy = Math.min
