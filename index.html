<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Money Tree: My Evolution</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.7);
            --accent: #6366f1;
            --gold: #f59e0b;
            --emerald: #10b981;
        }

        body {
            margin: 0; padding: 0; font-family: 'Montserrat', sans-serif;
            background: radial-gradient(circle at top, #1e293b, #020617);
            color: white; height: 100vh; overflow: hidden;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        .app { height: 100vh; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; }

        .header {
            background: var(--card); backdrop-filter: blur(15px);
            padding: 15px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center; margin-bottom: 20px;
        }
        .balance-val { font-size: 36px; font-weight: 800; color: var(--gold); text-shadow: 0 0 15px rgba(245, 158, 11, 0.3); }
        .lvl-name { font-size: 10px; opacity: 0.5; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 5px; }

        .tab-content { display: none; flex: 1; flex-direction: column; align-items: center; width: 100%; }
        .tab-content.active { display: flex; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–µ—Ä–µ–≤–∞ */
        .tree-container {
            flex: 1; display: flex; align-items: center; justify-content: center;
            position: relative; width: 100%;
        }
        
        #treeBtn {
            max-width: 300px; max-height: 300px; width: 80vw; height: 80vw;
            object-fit: contain; cursor: pointer;
            transition: transform 0.05s ease;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
            z-index: 10;
        }
        #treeBtn:active { transform: scale(0.92); }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –¥–ª—è –∑–æ–ª–æ—Ç–æ–≥–æ –¥–µ—Ä–µ–≤–∞ */
        .golden-glow {
            position: absolute; width: 250px; height: 250px;
            background: radial-gradient(circle, rgba(245, 158, 11, 0.2) 0%, transparent 70%);
            border-radius: 50%; display: none;
        }

        .energy-box { width: 100%; margin-top: auto; padding-bottom: 90px; }
        .energy-bar { width: 100%; height: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; overflow: hidden; margin-top: 5px; border: 1px solid rgba(255,255,255,0.05); }
        .energy-fill { height: 100%; background: linear-gradient(90deg, var(--accent), #818cf8); transition: width 0.3s; }

        .boost-card {
            width: 100%; background: var(--card); padding: 15px; border-radius: 20px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.05);
        }
        .buy-btn {
            background: var(--accent); color: white; border: none; padding: 10px 20px;
            border-radius: 14px; font-weight: 800; font-size: 13px;
        }

        .nav {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px);
            border-radius: 24px; display: flex; padding: 6px;
            border: 1px solid rgba(255,255,255,0.1); z-index: 100;
        }
        .nav-item { flex: 1; padding: 12px; text-align: center; border-radius: 18px; font-size: 10px; font-weight: 700; opacity: 0.4; }
        .nav-item.active { opacity: 1; background: rgba(255,255,255,0.05); color: var(--gold); }

        .tap-pop { position: absolute; color: white; font-weight: 800; font-size: 32px; pointer-events: none; animation: tapUp 0.6s ease-out forwards; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        @keyframes tapUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-120px); opacity: 0; } }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div id="lvlLabel" class="lvl-name">–ó–ê–ì–†–£–ó–ö–ê...</div>
            <div class="balance-val" id="coins">0</div>
            <div style="font-size: 13px; color: var(--emerald); font-weight: 600;">‚õèÔ∏è +<span id="pIncome">0</span>/—Å–µ–∫</div>
        </div>

        <div id="game" class="tab-content active">
            <div class="tree-container">
                <div id="glow" class="golden-glow"></div>
                <img src="" id="treeBtn" alt="Tree">
            </div>
            <div class="energy-box">
                <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:700;">
                    <span>–≠–ù–ï–†–ì–ò–Ø</span>
                    <span id="eText">100/100</span>
                </div>
                <div class="energy-bar"><div class="energy-fill" id="eFill"></div></div>
            </div>
        </div>

        <div id="boosts" class="tab-content">
            <h2 style="width:100%; margin-bottom: 20px;">–£–ª—É—á—à–µ–Ω–∏—è</h2>
            <div class="boost-card">
                <div><b>üåü –≠–≤–æ–ª—é—Ü–∏—è</b><br><small id="evoCost">2,000</small></div>
                <button class="buy-btn" onclick="buy('evo')">–ê–ü</button>
            </div>
            <div class="boost-card">
                <div><b>üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞</b><br><small id="tapCost">100</small></div>
                <button class="buy-btn" onclick="buy('tap')">–ê–ü</button>
            </div>
            <div class="boost-card">
                <div><b>ü§ñ –°–∞–¥–æ–≤–Ω–∏–∫</b><br><small id="autoCost">500</small></div>
                <button class="buy-btn" onclick="buy('auto')">–ê–ü</button>
            </div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="showTab('game', this)">–ì–õ–ê–í–ù–ê–Ø</div>
            <div class="nav-item" onclick="showTab('boosts', this)">–ú–ê–ì–ê–ó–ò–ù</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const userId = (tg.initDataUnsafe && tg.initDataUnsafe.user) ? tg.initDataUnsafe.user.id : 'guest';
        const SAVE_KEY = `mTree_v42_${userId}`;

        // –¢–í–û–ò –°–°–´–õ–ö–ò –ù–ê –§–û–¢–û (–Ø –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª –∏—Ö –≤ –ø—Ä—è–º—ã–µ)
        const imgs = [
            "https://i.ibb.co/PzVbNnPJ/image.png", // –°—Ç–∞–¥–∏—è 1
            "https://i.ibb.co/s9HrPnmZ/image.png", // –°—Ç–∞–¥–∏—è 2
            "https://i.ibb.co/SDZ6wD9b/image.png", // –°—Ç–∞–¥–∏—è 3
            "https://i.ibb.co/QFwFTZR2/image.png", // –°—Ç–∞–¥–∏—è 4
            "https://i.ibb.co/FkBT0nPf/image.png"  // –°—Ç–∞–¥–∏—è 5 (–ó–æ–ª–æ—Ç–æ–µ)
        ];
        const names = ["–†–æ—Å—Ç–æ–∫", "–ö—É—Å—Ç", "–î–µ—Ä–µ–≤–æ", "–ë–æ–ª—å—à–æ–µ –î–µ—Ä–µ–≤–æ", "–ó–û–õ–û–¢–û–ï –î–†–ï–í–û"];

        let state = JSON.parse(localStorage.getItem(SAVE_KEY)) || {
            coins: 0, power: 1, energy: 100, maxEnergy: 100, passive: 0, treeLvl: 0
        };

        function updateUI() {
            const multi = 1 + (state.treeLvl * 0.5);
            document.getElementById('coins').textContent = Math.floor(state.coins).toLocaleString();
            document.getElementById('pIncome').textContent = (state.passive * multi).toFixed(1);
            document.getElementById('eText').textContent = Math.floor(state.energy) + "/" + state.maxEnergy;
            document.getElementById('eFill').style.width = (state.energy / state.maxEnergy * 100) + "%";
            
            document.getElementById('lvlLabel').textContent = names[state.treeLvl];
            document.getElementById('treeBtn').src = imgs[state.treeLvl];
            
            // –°–≤–µ—á–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞–¥–∏–∏
            document.getElementById('glow').style.display = state.treeLvl === 4 ? 'block' : 'none';

            document.getElementById('evoCost').textContent = state.treeLvl < 4 ? ((state.treeLvl + 1) * 2000).toLocaleString() : "–ú–ê–ö–°–ò–ú–£–ú";
            document.getElementById('tapCost').textContent = Math.floor(100 * Math.pow(1.6, state.power - 1)).toLocaleString();
            document.getElementById('autoCost').textContent = Math.floor((state.passive + 1) * 500).toLocaleString();

            localStorage.setItem(SAVE_KEY, JSON.stringify(state));
        }

        function handleTap(e) {
            if (state.energy < 1) {
                tg.HapticFeedback.notificationOccurred('warning');
                return;
            }
            const multi = 1 + (state.treeLvl * 0.5);
            const gain = state.power * multi;
            state.coins += gain;
            state.energy -= 1;

            const p = document.createElement('div');
            p.className = 'tap-pop';
            p.textContent = `+${Math.floor(gain)}`;
            const x = e.clientX || (e.touches ? e.touches[0].clientX : window.innerWidth/2);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : window.innerHeight/2);
            p.style.left = x + 'px';
            p.style.top = y + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 600);

            tg.HapticFeedback.impactOccurred('medium');
            updateUI();
        }

        const treeImg = document.getElementById('treeBtn');
        treeImg.addEventListener('touchstart', (e) => { e.preventDefault(); handleTap(e); });
        treeImg.addEventListener('mousedown', (e) => { handleTap(e); });

        function buy(type) {
            let cost = 0;
            if (type === 'evo') cost = (state.treeLvl + 1) * 2000;
            else if (type === 'tap') cost = Math.floor(100 * Math.pow(1.6, state.power - 1));
            else if (type === 'auto') cost = Math.floor((state.passive + 1) * 500);

            if (state.coins >= cost) {
                if (type === 'evo' && state.treeLvl < 4) { state.coins -= cost; state.treeLvl++; }
                else if (type === 'tap') { state.coins -= cost; state.power++; }
                else if (type === 'auto') { state.coins -= cost; state.passive += 0.5; }
                tg.HapticFeedback.notificationOccurred('success');
                updateUI();
            } else {
                tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! üí∞");
            }
        }

        function showTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        setInterval(() => {
            if (state.energy < state.maxEnergy) state.energy = Math.min(state.maxEnergy, state.energy + 0.2);
            if (state.passive > 0) state.coins += (state.passive * (1 + state.treeLvl * 0.5)) / 10;
            updateUI();
        }, 100);

        updateUI();
    </script>
</body>
</html>
